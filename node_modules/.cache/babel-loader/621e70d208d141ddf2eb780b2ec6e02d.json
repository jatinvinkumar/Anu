{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.signInWithPhoneNumber = exports.linkWithCredential = exports.reloadAuth = exports.updateEmail = exports.updateAuth = exports.updateProfile = exports.verifyPasswordResetCode = exports.confirmPasswordReset = exports.resetPassword = exports.createUser = exports.logout = exports.login = exports.init = exports.handleRedirectResult = exports.createUserProfile = exports.watchUserProfile = exports.handleProfileWatchResponse = exports.unWatchUserProfile = undefined;\n\nvar _pick2 = require('lodash/pick');\n\nvar _pick3 = _interopRequireDefault(_pick2);\n\nvar _omit2 = require('lodash/omit');\n\nvar _omit3 = _interopRequireDefault(_omit2);\n\nvar _forEach2 = require('lodash/forEach');\n\nvar _forEach3 = _interopRequireDefault(_forEach2);\n\nvar _isFunction2 = require('lodash/isFunction');\n\nvar _isFunction3 = _interopRequireDefault(_isFunction2);\n\nvar _isString2 = require('lodash/isString');\n\nvar _isString3 = _interopRequireDefault(_isString2);\n\nvar _isArray2 = require('lodash/isArray');\n\nvar _isArray3 = _interopRequireDefault(_isArray2);\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nexports.linkAndRetrieveDataWithCredential = linkAndRetrieveDataWithCredential;\nexports.linkWithPopup = linkWithPopup;\nexports.linkWithRedirect = linkWithRedirect;\n\nvar _constants = require('../constants');\n\nvar _helpers = require('../helpers');\n\nvar _auth = require('../utils/auth');\n\nvar _populate = require('../utils/populate');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _toConsumableArray(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  } else {\n    return Array.from(arr);\n  }\n}\n\nvar dispatchLoginError = function dispatchLoginError(dispatch, authError) {\n  return dispatch({\n    type: _constants.actionTypes.LOGIN_ERROR,\n    authError: authError\n  });\n};\n\nvar unWatchUserProfile = exports.unWatchUserProfile = function unWatchUserProfile(firebase) {\n  var _firebase$_ = firebase._,\n      authUid = _firebase$_.authUid,\n      _firebase$_$config = _firebase$_.config,\n      userProfile = _firebase$_$config.userProfile,\n      useFirestoreForProfile = _firebase$_$config.useFirestoreForProfile;\n\n  if (firebase._.profileWatch) {\n    if (useFirestoreForProfile && firebase.firestore) {\n      firebase._.profileWatch();\n    } else {\n      firebase.database().ref().child(userProfile + '/' + authUid).off('value', firebase._.profileWatch);\n    }\n\n    firebase._.profileWatch = null;\n  }\n};\n\nvar getProfileFromSnap = function getProfileFromSnap(snap) {\n  if (snap && snap.val) {\n    return snap.val();\n  }\n\n  if (snap && snap.data && snap.exists) {\n    return snap.data();\n  }\n\n  return null;\n};\n\nvar handleProfileWatchResponse = exports.handleProfileWatchResponse = function handleProfileWatchResponse(dispatch, firebase, userProfileSnap, token) {\n  var _firebase$_$config2 = firebase._.config,\n      profileParamsToPopulate = _firebase$_$config2.profileParamsToPopulate,\n      autoPopulateProfile = _firebase$_$config2.autoPopulateProfile,\n      useFirestoreForProfile = _firebase$_$config2.useFirestoreForProfile,\n      logErrors = _firebase$_$config2.logErrors;\n  var profile = getProfileFromSnap(userProfileSnap);\n\n  if (!profileParamsToPopulate || useFirestoreForProfile || !(0, _isArray3.default)(profileParamsToPopulate) && !(0, _isString3.default)(profileParamsToPopulate)) {\n    if (useFirestoreForProfile && profileParamsToPopulate) {\n      console.warn('Profile population is not yet supported for Firestore');\n    }\n\n    dispatch({\n      type: _constants.actionTypes.SET_PROFILE,\n      profile: token ? _extends({}, profile, {\n        token: token\n      }) : profile\n    });\n  } else {\n    (0, _populate.promisesForPopulate)(firebase, userProfileSnap.key, profile, profileParamsToPopulate).then(function (data) {\n      (0, _forEach3.default)(data, function (result, path) {\n        dispatch({\n          type: _constants.actionTypes.SET,\n          path: path,\n          data: result,\n          timestamp: Date.now(),\n          requesting: false,\n          requested: true\n        });\n      });\n\n      if (!autoPopulateProfile) {\n        dispatch({\n          type: _constants.actionTypes.SET_PROFILE,\n          profile: profile\n        });\n      } else {\n        var populates = (0, _populate.getPopulateObjs)(profileParamsToPopulate);\n\n        var _profile = userProfileSnap.val();\n\n        dispatch({\n          type: _constants.actionTypes.SET_PROFILE,\n          profile: (0, _helpers.populate)({\n            profile: token ? _extends({}, _profile, {\n              token: token\n            }) : _profile,\n            data: data\n          }, 'profile', populates)\n        });\n      }\n    }).catch(function (err) {\n      if (logErrors) {\n        console.error('RRF: Error retrieving data for profile population. Firebase:', err);\n      }\n\n      dispatch({\n        type: _constants.actionTypes.UNAUTHORIZED_ERROR,\n        authError: 'Error during profile population: ' + err.message\n      });\n      dispatch({\n        type: _constants.actionTypes.SET_PROFILE,\n        profile: profile\n      });\n    });\n  }\n};\n\nfunction createProfileWatchErrorHandler(dispatch, firebase) {\n  var _firebase$_$config3 = firebase._.config,\n      onProfileListenerError = _firebase$_$config3.onProfileListenerError,\n      logErrors = _firebase$_$config3.logErrors;\n  return function handleProfileError(err) {\n    if (logErrors) {\n      console.error('Error with profile listener: ' + (err.message || ''), err);\n    }\n\n    if ((0, _isFunction3.default)(onProfileListenerError)) {\n      var factoryResult = onProfileListenerError(err, firebase);\n\n      if ((0, _isFunction3.default)(factoryResult.then)) {\n        return factoryResult;\n      }\n    }\n\n    return Promise.reject(err);\n  };\n}\n\nvar watchUserProfile = exports.watchUserProfile = function watchUserProfile(dispatch, firebase) {\n  var _firebase$_2 = firebase._,\n      authUid = _firebase$_2.authUid,\n      _firebase$_2$config = _firebase$_2.config,\n      userProfile = _firebase$_2$config.userProfile,\n      useFirestoreForProfile = _firebase$_2$config.useFirestoreForProfile,\n      enableClaims = _firebase$_2$config.enableClaims;\n  unWatchUserProfile(firebase);\n\n  if (userProfile) {\n    if (useFirestoreForProfile && firebase.firestore) {\n      firebase._.profileWatch = firebase.firestore().collection(userProfile).doc(authUid).onSnapshot(function (userProfileSnap) {\n        return enableClaims ? firebase.auth().currentUser.getIdTokenResult(true).then(function (token) {\n          return handleProfileWatchResponse(dispatch, firebase, userProfileSnap, token);\n        }) : handleProfileWatchResponse(dispatch, firebase, userProfileSnap);\n      }, createProfileWatchErrorHandler(dispatch, firebase));\n    } else if (firebase.database) {\n      firebase._.profileWatch = firebase.database().ref().child(userProfile + '/' + authUid).on('value', function (userProfileSnap) {\n        return enableClaims ? firebase.auth().currentUser.getIdTokenResult(true).then(function (token) {\n          return handleProfileWatchResponse(dispatch, firebase, userProfileSnap, token);\n        }) : handleProfileWatchResponse(dispatch, firebase, userProfileSnap);\n      }, createProfileWatchErrorHandler(dispatch, firebase));\n    } else {\n      throw new Error('Real Time Database or Firestore must be included to enable user profile');\n    }\n  }\n};\n\nvar createUserProfile = exports.createUserProfile = function createUserProfile(dispatch, firebase, userData, profile) {\n  var config = firebase._.config;\n\n  if (!config.userProfile || !firebase.database && !firebase.firestore) {\n    return Promise.resolve(userData);\n  }\n\n  if ((0, _isFunction3.default)(config.profileFactory)) {\n    try {\n      profile = config.profileFactory(userData, profile);\n    } catch (err) {\n      console.error('Error occured within profileFactory function:', err.message || err);\n      return Promise.reject(err);\n    }\n  }\n\n  if (config.useFirestoreForProfile) {\n    return firebase.firestore().collection(config.userProfile).doc(userData.uid || userData.user.uid).get().then(function (profileSnap) {\n      if (!config.updateProfileOnLogin && profileSnap.exists) {\n        return profileSnap.data();\n      }\n\n      var newProfile = profile;\n\n      if (!newProfile) {\n        var userDataObject = userData.uid ? userData.toJSON ? userData.toJSON() : userData : userData.user.toJSON ? userData.user.toJSON() : userData.user;\n        newProfile = _extends({}, (0, _omit3.default)(userDataObject, config.keysToRemoveFromAuth), {\n          avatarUrl: userDataObject.photoURL\n        });\n      }\n\n      if ((0, _isArray3.default)(newProfile.providerData) && newProfile.providerData.length) {\n        newProfile.providerData = newProfile.providerData.map(function (providerDataItem) {\n          return (0, _pick3.default)(providerDataItem, config.keysToPreserveFromProviderData);\n        });\n      }\n\n      return profileSnap.ref.set(newProfile, {\n        merge: true\n      }).then(function () {\n        return newProfile;\n      });\n    }).catch(function (err) {\n      dispatch({\n        type: _constants.actionTypes.UNAUTHORIZED_ERROR,\n        authError: err\n      });\n      return Promise.reject(err);\n    });\n  }\n\n  return firebase.database().ref().child(config.userProfile + '/' + (userData.user ? userData.user.uid : userData.uid)).once('value').then(function (profileSnap) {\n    return !config.updateProfileOnLogin && profileSnap.val() !== null ? profileSnap.val() : profileSnap.ref.update(profile).then(function () {\n      return profile;\n    });\n  }).catch(function (err) {\n    dispatch({\n      type: _constants.actionTypes.UNAUTHORIZED_ERROR,\n      authError: err\n    });\n\n    if ((0, _isFunction3.default)(config.onProfileWriteError)) {\n      config.onProfileWriteError(err, firebase);\n    }\n\n    return Promise.reject(err);\n  });\n};\n\nvar handleAuthStateChange = function handleAuthStateChange(dispatch, firebase, authData) {\n  var config = firebase._.config;\n\n  if (!authData) {\n    if ((0, _isFunction3.default)(config.onAuthStateChanged)) {\n      firebase._.config.onAuthStateChanged(authData, firebase, dispatch);\n    }\n\n    dispatch({\n      type: _constants.actionTypes.AUTH_EMPTY_CHANGE,\n      preserve: config.preserveOnEmptyAuthChange\n    });\n  } else {\n    firebase._.authUid = authData.uid;\n\n    if (config.presence) {\n      (0, _auth.setupPresence)(dispatch, firebase);\n    }\n\n    dispatch({\n      type: _constants.actionTypes.LOGIN,\n      auth: authData,\n      preserve: config.preserveOnLogin\n    });\n    watchUserProfile(dispatch, firebase);\n\n    if ((0, _isFunction3.default)(config.onAuthStateChanged)) {\n      config.onAuthStateChanged(authData, firebase, dispatch);\n    }\n  }\n};\n\nvar handleRedirectResult = exports.handleRedirectResult = function handleRedirectResult(dispatch, firebase, authData) {\n  if (typeof firebase._.config.onRedirectResult === 'function') {\n    firebase._.config.onRedirectResult(authData, firebase, dispatch);\n  }\n\n  if (authData && authData.user) {\n    var user = authData.user;\n    firebase._.authUid = user.uid;\n    watchUserProfile(dispatch, firebase);\n    dispatch({\n      type: _constants.actionTypes.LOGIN,\n      auth: user,\n      preserve: firebase._.config.preserveOnLogin\n    });\n    return createUserProfile(dispatch, firebase, user, {\n      email: user.email,\n      displayName: user.providerData[0].displayName || user.email,\n      avatarUrl: user.providerData[0].photoURL,\n      providerData: user.providerData\n    });\n  }\n};\n\nvar init = exports.init = function init(dispatch, firebase) {\n  if (!firebase.auth) {\n    return;\n  }\n\n  dispatch({\n    type: _constants.actionTypes.AUTHENTICATION_INIT_STARTED\n  });\n  firebase.auth().onAuthStateChanged(function (authData) {\n    return handleAuthStateChange(dispatch, firebase, authData);\n  });\n\n  if (firebase._.config.enableRedirectHandling && (0, _isFunction3.default)(firebase.auth().getRedirectResult) && typeof window !== 'undefined' && window.location && window.location.protocol && window.location.protocol.indexOf('http') !== -1) {\n    firebase.auth().getRedirectResult().then(function (authData) {\n      return handleRedirectResult(dispatch, firebase, authData);\n    }).catch(function (error) {\n      dispatchLoginError(dispatch, error);\n      return Promise.reject(error);\n    });\n  }\n\n  firebase.auth().currentUser;\n  dispatch({\n    type: _constants.actionTypes.AUTHENTICATION_INIT_FINISHED\n  });\n};\n\nvar login = exports.login = function login(dispatch, firebase, credentials) {\n  var _firebase$auth;\n\n  if (firebase._.config.resetBeforeLogin) {\n    dispatchLoginError(dispatch, null);\n  }\n\n  var _getLoginMethodAndPar = (0, _auth.getLoginMethodAndParams)(firebase, credentials),\n      method = _getLoginMethodAndPar.method,\n      params = _getLoginMethodAndPar.params;\n\n  return (_firebase$auth = firebase.auth())[method].apply(_firebase$auth, _toConsumableArray(params)).then(function (userData) {\n    if (!userData) return Promise.resolve(null);\n\n    if (['signInWithEmailAndPassword', 'signInAndRetrieveDataWithEmailAndPassword'].includes(method)) {\n      return {\n        user: userData\n      };\n    }\n\n    if (['signInWithCustomToken', 'signInAndRetrieveDataWithCustomToken'].includes(method)) {\n      if (!firebase._.config.updateProfileOnLogin) {\n        return {\n          user: userData\n        };\n      }\n\n      return createUserProfile(dispatch, firebase, userData, credentials.profile);\n    }\n\n    if (method === 'signInWithPhoneNumber') {\n      return _extends({}, userData, {\n        confirm: function confirm(code) {\n          return userData.confirm(code).then(function (_ref) {\n            var user = _ref.user,\n                additionalUserInfo = _ref.additionalUserInfo;\n            return createUserProfile(dispatch, firebase, user, {\n              phoneNumber: user.providerData[0].phoneNumber,\n              providerData: user.providerData\n            }).then(function (profile) {\n              return {\n                profile: profile,\n                user: user,\n                additionalUserInfo: additionalUserInfo\n              };\n            });\n          });\n        }\n      });\n    }\n\n    var user = userData.user || userData;\n    return createUserProfile(dispatch, firebase, user, credentials.profile || {\n      email: user.email,\n      displayName: user.providerData[0].displayName || user.email,\n      avatarUrl: user.providerData[0].photoURL,\n      providerData: user.providerData\n    }).then(function (profile) {\n      return _extends({\n        profile: profile\n      }, userData);\n    });\n  }).catch(function (err) {\n    dispatchLoginError(dispatch, err);\n    return Promise.reject(err);\n  });\n};\n\nvar logout = exports.logout = function logout(dispatch, firebase) {\n  unWatchUserProfile(firebase);\n  return firebase.auth().signOut().then(function () {\n    var action = {\n      type: _constants.actionTypes.LOGOUT\n    };\n\n    if (firebase._.config.preserveOnLogout) {\n      action.preserve = firebase._.config.preserveOnLogout;\n    }\n\n    dispatch(action);\n    firebase._.authUid = null;\n    return firebase;\n  });\n};\n\nvar createUser = exports.createUser = function createUser(dispatch, firebase, _ref2, profile) {\n  var email = _ref2.email,\n      password = _ref2.password,\n      signIn = _ref2.signIn;\n  dispatchLoginError(dispatch, null);\n\n  if (!email || !password) {\n    var error = new Error('Email and Password are required to create user');\n    dispatchLoginError(dispatch, error);\n    return Promise.reject(error);\n  }\n\n  return firebase.auth().createUserWithEmailAndPassword(email, password).then(function (userData) {\n    return firebase.auth().currentUser || !!signIn && signIn === false ? createUserProfile(dispatch, firebase, userData, profile || {\n      email: email\n    }) : login(dispatch, firebase, {\n      email: email,\n      password: password\n    }).then(function () {\n      return createUserProfile(dispatch, firebase, userData, profile || {\n        email: email\n      });\n    }).catch(function (err) {\n      if (err) {\n        switch (err.code) {\n          case 'auth/user-not-found':\n            dispatchLoginError(dispatch, new Error('The specified user account does not exist.'));\n            break;\n\n          default:\n            dispatchLoginError(dispatch, err);\n        }\n      }\n\n      return Promise.reject(err);\n    });\n  }).catch(function (err) {\n    dispatchLoginError(dispatch, err);\n    return Promise.reject(err);\n  });\n};\n\nvar resetPassword = exports.resetPassword = function resetPassword(dispatch, firebase, email) {\n  dispatchLoginError(dispatch, null);\n  return firebase.auth().sendPasswordResetEmail(email).catch(function (err) {\n    if (err) {\n      switch (err.code) {\n        case 'auth/user-not-found':\n          dispatchLoginError(dispatch, new Error('The specified user account does not exist.'));\n          break;\n\n        default:\n          dispatchLoginError(dispatch, err);\n      }\n\n      return Promise.reject(err);\n    }\n  });\n};\n\nvar confirmPasswordReset = exports.confirmPasswordReset = function confirmPasswordReset(dispatch, firebase, code, password) {\n  dispatchLoginError(dispatch, null);\n  return firebase.auth().confirmPasswordReset(code, password).catch(function (err) {\n    if (err) {\n      switch (err.code) {\n        case 'auth/expired-action-code':\n          dispatchLoginError(dispatch, new Error('The action code has expired.'));\n          break;\n\n        case 'auth/invalid-action-code':\n          dispatchLoginError(dispatch, new Error('The action code is invalid.'));\n          break;\n\n        case 'auth/user-disabled':\n          dispatchLoginError(dispatch, new Error('The user is disabled.'));\n          break;\n\n        case 'auth/user-not-found':\n          dispatchLoginError(dispatch, new Error('The user is not found.'));\n          break;\n\n        case 'auth/weak-password':\n          dispatchLoginError(dispatch, new Error('The password is not strong enough.'));\n          break;\n\n        default:\n          dispatchLoginError(dispatch, err);\n      }\n\n      return Promise.reject(err);\n    }\n  });\n};\n\nvar verifyPasswordResetCode = exports.verifyPasswordResetCode = function verifyPasswordResetCode(dispatch, firebase, code) {\n  dispatchLoginError(dispatch, null);\n  return firebase.auth().verifyPasswordResetCode(code).catch(function (err) {\n    if (err) {\n      dispatchLoginError(dispatch, err);\n    }\n\n    return Promise.reject(err);\n  });\n};\n\nvar updateProfile = exports.updateProfile = function updateProfile(dispatch, firebase, profileUpdate, options) {\n  var config = firebase._.config;\n  dispatch({\n    type: _constants.actionTypes.PROFILE_UPDATE_START,\n    payload: profileUpdate\n  });\n  var updatePromise = config.useFirestoreForProfile ? _auth.updateProfileOnFirestore : _auth.updateProfileOnRTDB;\n  return updatePromise(firebase, profileUpdate, options).then(function (snap) {\n    dispatch({\n      type: _constants.actionTypes.PROFILE_UPDATE_SUCCESS,\n      payload: config.useFirestoreForProfile ? snap.data() : snap.val()\n    });\n    return snap;\n  }).catch(function (error) {\n    dispatch({\n      type: _constants.actionTypes.PROFILE_UPDATE_ERROR,\n      error: error\n    });\n    return Promise.reject(error);\n  });\n};\n\nvar updateAuth = exports.updateAuth = function updateAuth(dispatch, firebase, authUpdate, updateInProfile) {\n  dispatch({\n    type: _constants.actionTypes.AUTH_UPDATE_START,\n    payload: authUpdate\n  });\n\n  if (!firebase.auth().currentUser) {\n    var error = new Error('User must be logged in to update auth.');\n    dispatch({\n      type: _constants.actionTypes.AUTH_UPDATE_ERROR,\n      payload: error\n    });\n    return Promise.reject(error);\n  }\n\n  return firebase.auth().currentUser.updateProfile(authUpdate).then(function (payload) {\n    dispatch({\n      type: _constants.actionTypes.AUTH_UPDATE_SUCCESS,\n      auth: firebase.auth().currentUser\n    });\n\n    if (updateInProfile) {\n      return updateProfile(dispatch, firebase, authUpdate);\n    }\n\n    return payload;\n  }).catch(function (error) {\n    dispatch({\n      type: _constants.actionTypes.AUTH_UPDATE_ERROR,\n      error: error\n    });\n    return Promise.reject(error);\n  });\n};\n\nvar updateEmail = exports.updateEmail = function updateEmail(dispatch, firebase, newEmail, updateInProfile) {\n  dispatch({\n    type: _constants.actionTypes.EMAIL_UPDATE_START,\n    payload: newEmail\n  });\n\n  if (!firebase.auth().currentUser) {\n    var error = new Error('User must be logged in to update email.');\n    dispatch({\n      type: _constants.actionTypes.EMAIL_UPDATE_ERROR,\n      error: error\n    });\n    return Promise.reject(error);\n  }\n\n  return firebase.auth().currentUser.updateEmail(newEmail).then(function (payload) {\n    dispatch({\n      type: _constants.actionTypes.EMAIL_UPDATE_SUCCESS,\n      payload: newEmail\n    });\n\n    if (updateInProfile) {\n      return updateProfile(dispatch, firebase, {\n        email: newEmail\n      });\n    }\n\n    return payload;\n  }).catch(function (error) {\n    dispatch({\n      type: _constants.actionTypes.EMAIL_UPDATE_ERROR,\n      error: error\n    });\n    return Promise.reject(error);\n  });\n};\n\nvar reloadAuth = exports.reloadAuth = function reloadAuth(dispatch, firebase) {\n  dispatch({\n    type: _constants.actionTypes.AUTH_RELOAD_START\n  });\n\n  if (!firebase.auth().currentUser) {\n    var error = new Error('User must be logged in to reload auth.');\n    dispatch({\n      type: _constants.actionTypes.AUTH_RELOAD_ERROR,\n      error: error\n    });\n    return Promise.reject(error);\n  }\n\n  return firebase.auth().currentUser.reload().then(function () {\n    var auth = firebase.auth().currentUser;\n    dispatch({\n      type: _constants.actionTypes.AUTH_RELOAD_SUCCESS,\n      payload: auth\n    });\n    return auth;\n  }).catch(function (error) {\n    dispatch({\n      type: _constants.actionTypes.AUTH_RELOAD_ERROR,\n      error: error\n    });\n    return Promise.reject(error);\n  });\n};\n\nvar linkWithCredential = exports.linkWithCredential = function linkWithCredential(dispatch, firebase, credential) {\n  dispatch({\n    type: _constants.actionTypes.AUTH_LINK_START\n  });\n\n  if (!firebase.auth().currentUser) {\n    var error = new Error('User must be logged in to link with credential.');\n    dispatch({\n      type: _constants.actionTypes.AUTH_LINK_ERROR,\n      error: error\n    });\n    return Promise.reject(error);\n  }\n\n  return firebase.auth().currentUser.linkWithCredential(credential).then(function (auth) {\n    dispatch({\n      type: _constants.actionTypes.AUTH_LINK_SUCCESS,\n      payload: auth\n    });\n    return auth;\n  }).catch(function (error) {\n    dispatch({\n      type: _constants.actionTypes.AUTH_LINK_ERROR,\n      error: error\n    });\n    return Promise.reject(error);\n  });\n};\n\nfunction linkWithAuthDispatch(promiseFunc, args, dispatch, firebase) {\n  dispatch({\n    type: _constants.actionTypes.AUTH_LINK_START\n  });\n\n  if (!firebase.auth().currentUser) {\n    var error = new Error('User must be logged in to link with credential.');\n    dispatch({\n      type: _constants.actionTypes.AUTH_LINK_ERROR,\n      error: error\n    });\n    return Promise.reject(error);\n  }\n\n  return promiseFunc.apply(undefined, _toConsumableArray(args)).then(function (auth) {\n    dispatch({\n      type: _constants.actionTypes.AUTH_LINK_SUCCESS,\n      payload: auth\n    });\n    return auth;\n  }).catch(function (error) {\n    dispatch({\n      type: _constants.actionTypes.AUTH_LINK_ERROR,\n      error: error\n    });\n    return Promise.reject(error);\n  });\n}\n\nfunction linkAndRetrieveDataWithCredential(dispatch, firebase, credential) {\n  return linkWithAuthDispatch(firebase.auth().currentUser.linkAndRetrieveDataWithCredential, [credential], dispatch, firebase);\n}\n\nfunction linkWithPopup(dispatch, firebase, credential) {\n  return linkWithAuthDispatch(firebase.auth().currentUser.linkWithPopup, [credential], dispatch, firebase);\n}\n\nfunction linkWithRedirect(dispatch, firebase, provider) {\n  return linkWithAuthDispatch(firebase.auth().currentUser.linkWithRedirect, [provider], dispatch, firebase);\n}\n\nvar signInWithPhoneNumber = exports.signInWithPhoneNumber = function signInWithPhoneNumber(firebase, dispatch, phoneNumber, applicationVerifier) {\n  var options = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {};\n  return login(dispatch, firebase, _extends({\n    phoneNumber: phoneNumber,\n    applicationVerifier: applicationVerifier\n  }, options));\n};\n\nexports.default = {\n  dispatchLoginError: dispatchLoginError,\n  unWatchUserProfile: unWatchUserProfile,\n  watchUserProfile: watchUserProfile,\n  init: init,\n  createUserProfile: createUserProfile,\n  login: login,\n  logout: logout,\n  createUser: createUser,\n  resetPassword: resetPassword,\n  confirmPasswordReset: confirmPasswordReset,\n  verifyPasswordResetCode: verifyPasswordResetCode,\n  updateAuth: updateAuth,\n  updateProfile: updateProfile,\n  updateEmail: updateEmail,\n  reloadAuth: reloadAuth,\n  signInWithPhoneNumber: signInWithPhoneNumber\n};","map":{"version":3,"sources":["/Users/pritivirajkumar/Documents/GitHub/Anu/node_modules/react-redux-firebase/es/actions/auth.js"],"names":["Object","defineProperty","exports","value","signInWithPhoneNumber","linkWithCredential","reloadAuth","updateEmail","updateAuth","updateProfile","verifyPasswordResetCode","confirmPasswordReset","resetPassword","createUser","logout","login","init","handleRedirectResult","createUserProfile","watchUserProfile","handleProfileWatchResponse","unWatchUserProfile","undefined","_pick2","require","_pick3","_interopRequireDefault","_omit2","_omit3","_forEach2","_forEach3","_isFunction2","_isFunction3","_isString2","_isString3","_isArray2","_isArray3","_extends","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","linkAndRetrieveDataWithCredential","linkWithPopup","linkWithRedirect","_constants","_helpers","_auth","_populate","obj","__esModule","default","_toConsumableArray","arr","Array","isArray","arr2","from","dispatchLoginError","dispatch","authError","type","actionTypes","LOGIN_ERROR","firebase","_firebase$_","_","authUid","_firebase$_$config","config","userProfile","useFirestoreForProfile","profileWatch","firestore","database","ref","child","off","getProfileFromSnap","snap","val","data","exists","userProfileSnap","token","_firebase$_$config2","profileParamsToPopulate","autoPopulateProfile","logErrors","profile","console","warn","SET_PROFILE","promisesForPopulate","then","result","path","SET","timestamp","Date","now","requesting","requested","populates","getPopulateObjs","_profile","populate","catch","err","error","UNAUTHORIZED_ERROR","message","createProfileWatchErrorHandler","_firebase$_$config3","onProfileListenerError","handleProfileError","factoryResult","Promise","reject","_firebase$_2","_firebase$_2$config","enableClaims","collection","doc","onSnapshot","auth","currentUser","getIdTokenResult","on","Error","userData","resolve","profileFactory","uid","user","get","profileSnap","updateProfileOnLogin","newProfile","userDataObject","toJSON","keysToRemoveFromAuth","avatarUrl","photoURL","providerData","map","providerDataItem","keysToPreserveFromProviderData","set","merge","once","update","onProfileWriteError","handleAuthStateChange","authData","onAuthStateChanged","AUTH_EMPTY_CHANGE","preserve","preserveOnEmptyAuthChange","presence","setupPresence","LOGIN","preserveOnLogin","onRedirectResult","email","displayName","AUTHENTICATION_INIT_STARTED","enableRedirectHandling","getRedirectResult","window","location","protocol","indexOf","AUTHENTICATION_INIT_FINISHED","credentials","_firebase$auth","resetBeforeLogin","_getLoginMethodAndPar","getLoginMethodAndParams","method","params","apply","includes","confirm","code","_ref","additionalUserInfo","phoneNumber","signOut","action","LOGOUT","preserveOnLogout","_ref2","password","signIn","createUserWithEmailAndPassword","sendPasswordResetEmail","profileUpdate","options","PROFILE_UPDATE_START","payload","updatePromise","updateProfileOnFirestore","updateProfileOnRTDB","PROFILE_UPDATE_SUCCESS","PROFILE_UPDATE_ERROR","authUpdate","updateInProfile","AUTH_UPDATE_START","AUTH_UPDATE_ERROR","AUTH_UPDATE_SUCCESS","newEmail","EMAIL_UPDATE_START","EMAIL_UPDATE_ERROR","EMAIL_UPDATE_SUCCESS","AUTH_RELOAD_START","AUTH_RELOAD_ERROR","reload","AUTH_RELOAD_SUCCESS","credential","AUTH_LINK_START","AUTH_LINK_ERROR","AUTH_LINK_SUCCESS","linkWithAuthDispatch","promiseFunc","args","provider","applicationVerifier"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.signInWithPhoneNumber = exports.linkWithCredential = exports.reloadAuth = exports.updateEmail = exports.updateAuth = exports.updateProfile = exports.verifyPasswordResetCode = exports.confirmPasswordReset = exports.resetPassword = exports.createUser = exports.logout = exports.login = exports.init = exports.handleRedirectResult = exports.createUserProfile = exports.watchUserProfile = exports.handleProfileWatchResponse = exports.unWatchUserProfile = undefined;\n\nvar _pick2 = require('lodash/pick');\n\nvar _pick3 = _interopRequireDefault(_pick2);\n\nvar _omit2 = require('lodash/omit');\n\nvar _omit3 = _interopRequireDefault(_omit2);\n\nvar _forEach2 = require('lodash/forEach');\n\nvar _forEach3 = _interopRequireDefault(_forEach2);\n\nvar _isFunction2 = require('lodash/isFunction');\n\nvar _isFunction3 = _interopRequireDefault(_isFunction2);\n\nvar _isString2 = require('lodash/isString');\n\nvar _isString3 = _interopRequireDefault(_isString2);\n\nvar _isArray2 = require('lodash/isArray');\n\nvar _isArray3 = _interopRequireDefault(_isArray2);\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nexports.linkAndRetrieveDataWithCredential = linkAndRetrieveDataWithCredential;\nexports.linkWithPopup = linkWithPopup;\nexports.linkWithRedirect = linkWithRedirect;\n\nvar _constants = require('../constants');\n\nvar _helpers = require('../helpers');\n\nvar _auth = require('../utils/auth');\n\nvar _populate = require('../utils/populate');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nvar dispatchLoginError = function dispatchLoginError(dispatch, authError) {\n  return dispatch({\n    type: _constants.actionTypes.LOGIN_ERROR,\n    authError: authError\n  });\n};\n\nvar unWatchUserProfile = exports.unWatchUserProfile = function unWatchUserProfile(firebase) {\n  var _firebase$_ = firebase._,\n      authUid = _firebase$_.authUid,\n      _firebase$_$config = _firebase$_.config,\n      userProfile = _firebase$_$config.userProfile,\n      useFirestoreForProfile = _firebase$_$config.useFirestoreForProfile;\n\n  if (firebase._.profileWatch) {\n    if (useFirestoreForProfile && firebase.firestore) {\n      firebase._.profileWatch();\n    } else {\n      firebase.database().ref().child(userProfile + '/' + authUid).off('value', firebase._.profileWatch);\n    }\n    firebase._.profileWatch = null;\n  }\n};\n\nvar getProfileFromSnap = function getProfileFromSnap(snap) {\n  if (snap && snap.val) {\n    return snap.val();\n  }\n\n  if (snap && snap.data && snap.exists) {\n    return snap.data();\n  }\n  return null;\n};\n\nvar handleProfileWatchResponse = exports.handleProfileWatchResponse = function handleProfileWatchResponse(dispatch, firebase, userProfileSnap, token) {\n  var _firebase$_$config2 = firebase._.config,\n      profileParamsToPopulate = _firebase$_$config2.profileParamsToPopulate,\n      autoPopulateProfile = _firebase$_$config2.autoPopulateProfile,\n      useFirestoreForProfile = _firebase$_$config2.useFirestoreForProfile,\n      logErrors = _firebase$_$config2.logErrors;\n\n  var profile = getProfileFromSnap(userProfileSnap);\n  if (!profileParamsToPopulate || useFirestoreForProfile || !(0, _isArray3.default)(profileParamsToPopulate) && !(0, _isString3.default)(profileParamsToPopulate)) {\n    if (useFirestoreForProfile && profileParamsToPopulate) {\n      console.warn('Profile population is not yet supported for Firestore');\n    }\n    dispatch({\n      type: _constants.actionTypes.SET_PROFILE,\n      profile: token ? _extends({}, profile, { token: token }) : profile\n    });\n  } else {\n    (0, _populate.promisesForPopulate)(firebase, userProfileSnap.key, profile, profileParamsToPopulate).then(function (data) {\n      (0, _forEach3.default)(data, function (result, path) {\n        dispatch({\n          type: _constants.actionTypes.SET,\n          path: path,\n          data: result,\n          timestamp: Date.now(),\n          requesting: false,\n          requested: true\n        });\n      });\n      if (!autoPopulateProfile) {\n        dispatch({ type: _constants.actionTypes.SET_PROFILE, profile: profile });\n      } else {\n        var populates = (0, _populate.getPopulateObjs)(profileParamsToPopulate);\n        var _profile = userProfileSnap.val();\n        dispatch({\n          type: _constants.actionTypes.SET_PROFILE,\n          profile: (0, _helpers.populate)({ profile: token ? _extends({}, _profile, { token: token }) : _profile, data: data }, 'profile', populates)\n        });\n      }\n    }).catch(function (err) {\n      if (logErrors) {\n        console.error('RRF: Error retrieving data for profile population. Firebase:', err);\n      }\n\n      dispatch({\n        type: _constants.actionTypes.UNAUTHORIZED_ERROR,\n        authError: 'Error during profile population: ' + err.message\n      });\n\n      dispatch({ type: _constants.actionTypes.SET_PROFILE, profile: profile });\n    });\n  }\n};\n\nfunction createProfileWatchErrorHandler(dispatch, firebase) {\n  var _firebase$_$config3 = firebase._.config,\n      onProfileListenerError = _firebase$_$config3.onProfileListenerError,\n      logErrors = _firebase$_$config3.logErrors;\n\n  return function handleProfileError(err) {\n    if (logErrors) {\n      console.error('Error with profile listener: ' + (err.message || ''), err);\n    }\n    if ((0, _isFunction3.default)(onProfileListenerError)) {\n      var factoryResult = onProfileListenerError(err, firebase);\n\n      if ((0, _isFunction3.default)(factoryResult.then)) {\n        return factoryResult;\n      }\n    }\n    return Promise.reject(err);\n  };\n}\n\nvar watchUserProfile = exports.watchUserProfile = function watchUserProfile(dispatch, firebase) {\n  var _firebase$_2 = firebase._,\n      authUid = _firebase$_2.authUid,\n      _firebase$_2$config = _firebase$_2.config,\n      userProfile = _firebase$_2$config.userProfile,\n      useFirestoreForProfile = _firebase$_2$config.useFirestoreForProfile,\n      enableClaims = _firebase$_2$config.enableClaims;\n\n  unWatchUserProfile(firebase);\n\n  if (userProfile) {\n    if (useFirestoreForProfile && firebase.firestore) {\n      firebase._.profileWatch = firebase.firestore().collection(userProfile).doc(authUid).onSnapshot(function (userProfileSnap) {\n        return enableClaims ? firebase.auth().currentUser.getIdTokenResult(true).then(function (token) {\n          return handleProfileWatchResponse(dispatch, firebase, userProfileSnap, token);\n        }) : handleProfileWatchResponse(dispatch, firebase, userProfileSnap);\n      }, createProfileWatchErrorHandler(dispatch, firebase));\n    } else if (firebase.database) {\n      firebase._.profileWatch = firebase.database().ref().child(userProfile + '/' + authUid).on('value', function (userProfileSnap) {\n        return enableClaims ? firebase.auth().currentUser.getIdTokenResult(true).then(function (token) {\n          return handleProfileWatchResponse(dispatch, firebase, userProfileSnap, token);\n        }) : handleProfileWatchResponse(dispatch, firebase, userProfileSnap);\n      }, createProfileWatchErrorHandler(dispatch, firebase));\n    } else {\n      throw new Error('Real Time Database or Firestore must be included to enable user profile');\n    }\n  }\n};\n\nvar createUserProfile = exports.createUserProfile = function createUserProfile(dispatch, firebase, userData, profile) {\n  var config = firebase._.config;\n\n  if (!config.userProfile || !firebase.database && !firebase.firestore) {\n    return Promise.resolve(userData);\n  }\n\n  if ((0, _isFunction3.default)(config.profileFactory)) {\n    try {\n      profile = config.profileFactory(userData, profile);\n    } catch (err) {\n      console.error('Error occured within profileFactory function:', err.message || err);\n\n      return Promise.reject(err);\n    }\n  }\n\n  if (config.useFirestoreForProfile) {\n    return firebase.firestore().collection(config.userProfile).doc(userData.uid || userData.user.uid).get().then(function (profileSnap) {\n      if (!config.updateProfileOnLogin && profileSnap.exists) {\n        return profileSnap.data();\n      }\n      var newProfile = profile;\n\n      if (!newProfile) {\n        var userDataObject = userData.uid ? userData.toJSON ? userData.toJSON() : userData : userData.user.toJSON ? userData.user.toJSON() : userData.user;\n\n        newProfile = _extends({}, (0, _omit3.default)(userDataObject, config.keysToRemoveFromAuth), {\n          avatarUrl: userDataObject.photoURL });\n      }\n\n      if ((0, _isArray3.default)(newProfile.providerData) && newProfile.providerData.length) {\n        newProfile.providerData = newProfile.providerData.map(function (providerDataItem) {\n          return (0, _pick3.default)(providerDataItem, config.keysToPreserveFromProviderData);\n        });\n      }\n\n      return profileSnap.ref.set(newProfile, { merge: true }).then(function () {\n        return newProfile;\n      });\n    }).catch(function (err) {\n      dispatch({ type: _constants.actionTypes.UNAUTHORIZED_ERROR, authError: err });\n      return Promise.reject(err);\n    });\n  }\n\n  return firebase.database().ref().child(config.userProfile + '/' + (userData.user ? userData.user.uid : userData.uid)).once('value').then(function (profileSnap) {\n    return !config.updateProfileOnLogin && profileSnap.val() !== null ? profileSnap.val() : profileSnap.ref.update(profile).then(function () {\n      return profile;\n    });\n  }).catch(function (err) {\n    dispatch({ type: _constants.actionTypes.UNAUTHORIZED_ERROR, authError: err });\n    if ((0, _isFunction3.default)(config.onProfileWriteError)) {\n      config.onProfileWriteError(err, firebase);\n    }\n    return Promise.reject(err);\n  });\n};\n\nvar handleAuthStateChange = function handleAuthStateChange(dispatch, firebase, authData) {\n  var config = firebase._.config;\n\n  if (!authData) {\n    if ((0, _isFunction3.default)(config.onAuthStateChanged)) {\n      firebase._.config.onAuthStateChanged(authData, firebase, dispatch);\n    }\n    dispatch({\n      type: _constants.actionTypes.AUTH_EMPTY_CHANGE,\n      preserve: config.preserveOnEmptyAuthChange\n    });\n  } else {\n    firebase._.authUid = authData.uid;\n    if (config.presence) {\n      (0, _auth.setupPresence)(dispatch, firebase);\n    }\n\n    dispatch({\n      type: _constants.actionTypes.LOGIN,\n      auth: authData,\n      preserve: config.preserveOnLogin\n    });\n\n    watchUserProfile(dispatch, firebase);\n\n    if ((0, _isFunction3.default)(config.onAuthStateChanged)) {\n      config.onAuthStateChanged(authData, firebase, dispatch);\n    }\n  }\n};\n\nvar handleRedirectResult = exports.handleRedirectResult = function handleRedirectResult(dispatch, firebase, authData) {\n  if (typeof firebase._.config.onRedirectResult === 'function') {\n    firebase._.config.onRedirectResult(authData, firebase, dispatch);\n  }\n  if (authData && authData.user) {\n    var user = authData.user;\n\n\n    firebase._.authUid = user.uid;\n    watchUserProfile(dispatch, firebase);\n\n    dispatch({\n      type: _constants.actionTypes.LOGIN,\n      auth: user,\n      preserve: firebase._.config.preserveOnLogin\n    });\n\n    return createUserProfile(dispatch, firebase, user, {\n      email: user.email,\n      displayName: user.providerData[0].displayName || user.email,\n      avatarUrl: user.providerData[0].photoURL,\n      providerData: user.providerData\n    });\n  }\n};\n\nvar init = exports.init = function init(dispatch, firebase) {\n  if (!firebase.auth) {\n    return;\n  }\n  dispatch({ type: _constants.actionTypes.AUTHENTICATION_INIT_STARTED });\n\n  firebase.auth().onAuthStateChanged(function (authData) {\n    return handleAuthStateChange(dispatch, firebase, authData);\n  });\n\n  if (firebase._.config.enableRedirectHandling && (0, _isFunction3.default)(firebase.auth().getRedirectResult) && typeof window !== 'undefined' && window.location && window.location.protocol && window.location.protocol.indexOf('http') !== -1) {\n    firebase.auth().getRedirectResult().then(function (authData) {\n      return handleRedirectResult(dispatch, firebase, authData);\n    }).catch(function (error) {\n      dispatchLoginError(dispatch, error);\n      return Promise.reject(error);\n    });\n  }\n\n  firebase.auth().currentUser;\n\n  dispatch({ type: _constants.actionTypes.AUTHENTICATION_INIT_FINISHED });\n};\n\nvar login = exports.login = function login(dispatch, firebase, credentials) {\n  var _firebase$auth;\n\n  if (firebase._.config.resetBeforeLogin) {\n    dispatchLoginError(dispatch, null);\n  }\n\n  var _getLoginMethodAndPar = (0, _auth.getLoginMethodAndParams)(firebase, credentials),\n      method = _getLoginMethodAndPar.method,\n      params = _getLoginMethodAndPar.params;\n\n  return (_firebase$auth = firebase.auth())[method].apply(_firebase$auth, _toConsumableArray(params)).then(function (userData) {\n    if (!userData) return Promise.resolve(null);\n\n    if (['signInWithEmailAndPassword', 'signInAndRetrieveDataWithEmailAndPassword'].includes(method)) {\n      return { user: userData };\n    }\n\n    if (['signInWithCustomToken', 'signInAndRetrieveDataWithCustomToken'].includes(method)) {\n      if (!firebase._.config.updateProfileOnLogin) {\n        return { user: userData };\n      }\n      return createUserProfile(dispatch, firebase, userData, credentials.profile);\n    }\n\n    if (method === 'signInWithPhoneNumber') {\n      return _extends({}, userData, {\n        confirm: function confirm(code) {\n          return userData.confirm(code).then(function (_ref) {\n            var user = _ref.user,\n                additionalUserInfo = _ref.additionalUserInfo;\n            return createUserProfile(dispatch, firebase, user, {\n              phoneNumber: user.providerData[0].phoneNumber,\n              providerData: user.providerData\n            }).then(function (profile) {\n              return { profile: profile, user: user, additionalUserInfo: additionalUserInfo };\n            });\n          });\n        }\n      });\n    }\n\n    var user = userData.user || userData;\n\n    return createUserProfile(dispatch, firebase, user, credentials.profile || {\n      email: user.email,\n      displayName: user.providerData[0].displayName || user.email,\n      avatarUrl: user.providerData[0].photoURL,\n      providerData: user.providerData\n    }).then(function (profile) {\n      return _extends({ profile: profile }, userData);\n    });\n  }).catch(function (err) {\n    dispatchLoginError(dispatch, err);\n    return Promise.reject(err);\n  });\n};\n\nvar logout = exports.logout = function logout(dispatch, firebase) {\n  unWatchUserProfile(firebase);\n  return firebase.auth().signOut().then(function () {\n    var action = {\n      type: _constants.actionTypes.LOGOUT\n    };\n    if (firebase._.config.preserveOnLogout) {\n      action.preserve = firebase._.config.preserveOnLogout;\n    }\n    dispatch(action);\n    firebase._.authUid = null;\n    return firebase;\n  });\n};\n\nvar createUser = exports.createUser = function createUser(dispatch, firebase, _ref2, profile) {\n  var email = _ref2.email,\n      password = _ref2.password,\n      signIn = _ref2.signIn;\n\n  dispatchLoginError(dispatch, null);\n\n  if (!email || !password) {\n    var error = new Error('Email and Password are required to create user');\n    dispatchLoginError(dispatch, error);\n    return Promise.reject(error);\n  }\n\n  return firebase.auth().createUserWithEmailAndPassword(email, password).then(function (userData) {\n    return firebase.auth().currentUser || !!signIn && signIn === false ? createUserProfile(dispatch, firebase, userData, profile || { email: email }) : login(dispatch, firebase, { email: email, password: password }).then(function () {\n      return createUserProfile(dispatch, firebase, userData, profile || { email: email });\n    }).catch(function (err) {\n      if (err) {\n        switch (err.code) {\n          case 'auth/user-not-found':\n            dispatchLoginError(dispatch, new Error('The specified user account does not exist.'));\n            break;\n          default:\n            dispatchLoginError(dispatch, err);\n        }\n      }\n      return Promise.reject(err);\n    });\n  }).catch(function (err) {\n    dispatchLoginError(dispatch, err);\n    return Promise.reject(err);\n  });\n};\n\nvar resetPassword = exports.resetPassword = function resetPassword(dispatch, firebase, email) {\n  dispatchLoginError(dispatch, null);\n  return firebase.auth().sendPasswordResetEmail(email).catch(function (err) {\n    if (err) {\n      switch (err.code) {\n        case 'auth/user-not-found':\n          dispatchLoginError(dispatch, new Error('The specified user account does not exist.'));\n          break;\n        default:\n          dispatchLoginError(dispatch, err);\n      }\n      return Promise.reject(err);\n    }\n  });\n};\n\nvar confirmPasswordReset = exports.confirmPasswordReset = function confirmPasswordReset(dispatch, firebase, code, password) {\n  dispatchLoginError(dispatch, null);\n  return firebase.auth().confirmPasswordReset(code, password).catch(function (err) {\n    if (err) {\n      switch (err.code) {\n        case 'auth/expired-action-code':\n          dispatchLoginError(dispatch, new Error('The action code has expired.'));\n          break;\n        case 'auth/invalid-action-code':\n          dispatchLoginError(dispatch, new Error('The action code is invalid.'));\n          break;\n        case 'auth/user-disabled':\n          dispatchLoginError(dispatch, new Error('The user is disabled.'));\n          break;\n        case 'auth/user-not-found':\n          dispatchLoginError(dispatch, new Error('The user is not found.'));\n          break;\n        case 'auth/weak-password':\n          dispatchLoginError(dispatch, new Error('The password is not strong enough.'));\n          break;\n        default:\n          dispatchLoginError(dispatch, err);\n      }\n      return Promise.reject(err);\n    }\n  });\n};\n\nvar verifyPasswordResetCode = exports.verifyPasswordResetCode = function verifyPasswordResetCode(dispatch, firebase, code) {\n  dispatchLoginError(dispatch, null);\n  return firebase.auth().verifyPasswordResetCode(code).catch(function (err) {\n    if (err) {\n      dispatchLoginError(dispatch, err);\n    }\n    return Promise.reject(err);\n  });\n};\n\nvar updateProfile = exports.updateProfile = function updateProfile(dispatch, firebase, profileUpdate, options) {\n  var config = firebase._.config;\n\n  dispatch({\n    type: _constants.actionTypes.PROFILE_UPDATE_START,\n    payload: profileUpdate\n  });\n\n  var updatePromise = config.useFirestoreForProfile ? _auth.updateProfileOnFirestore : _auth.updateProfileOnRTDB;\n  return updatePromise(firebase, profileUpdate, options).then(function (snap) {\n    dispatch({\n      type: _constants.actionTypes.PROFILE_UPDATE_SUCCESS,\n      payload: config.useFirestoreForProfile ? snap.data() : snap.val()\n    });\n    return snap;\n  }).catch(function (error) {\n    dispatch({ type: _constants.actionTypes.PROFILE_UPDATE_ERROR, error: error });\n    return Promise.reject(error);\n  });\n};\n\nvar updateAuth = exports.updateAuth = function updateAuth(dispatch, firebase, authUpdate, updateInProfile) {\n  dispatch({ type: _constants.actionTypes.AUTH_UPDATE_START, payload: authUpdate });\n\n  if (!firebase.auth().currentUser) {\n    var error = new Error('User must be logged in to update auth.');\n    dispatch({ type: _constants.actionTypes.AUTH_UPDATE_ERROR, payload: error });\n    return Promise.reject(error);\n  }\n\n  return firebase.auth().currentUser.updateProfile(authUpdate).then(function (payload) {\n    dispatch({\n      type: _constants.actionTypes.AUTH_UPDATE_SUCCESS,\n      auth: firebase.auth().currentUser\n    });\n    if (updateInProfile) {\n      return updateProfile(dispatch, firebase, authUpdate);\n    }\n    return payload;\n  }).catch(function (error) {\n    dispatch({ type: _constants.actionTypes.AUTH_UPDATE_ERROR, error: error });\n    return Promise.reject(error);\n  });\n};\n\nvar updateEmail = exports.updateEmail = function updateEmail(dispatch, firebase, newEmail, updateInProfile) {\n  dispatch({ type: _constants.actionTypes.EMAIL_UPDATE_START, payload: newEmail });\n\n  if (!firebase.auth().currentUser) {\n    var error = new Error('User must be logged in to update email.');\n    dispatch({ type: _constants.actionTypes.EMAIL_UPDATE_ERROR, error: error });\n    return Promise.reject(error);\n  }\n\n  return firebase.auth().currentUser.updateEmail(newEmail).then(function (payload) {\n    dispatch({ type: _constants.actionTypes.EMAIL_UPDATE_SUCCESS, payload: newEmail });\n    if (updateInProfile) {\n      return updateProfile(dispatch, firebase, { email: newEmail });\n    }\n    return payload;\n  }).catch(function (error) {\n    dispatch({ type: _constants.actionTypes.EMAIL_UPDATE_ERROR, error: error });\n    return Promise.reject(error);\n  });\n};\n\nvar reloadAuth = exports.reloadAuth = function reloadAuth(dispatch, firebase) {\n  dispatch({ type: _constants.actionTypes.AUTH_RELOAD_START });\n\n  if (!firebase.auth().currentUser) {\n    var error = new Error('User must be logged in to reload auth.');\n    dispatch({ type: _constants.actionTypes.AUTH_RELOAD_ERROR, error: error });\n    return Promise.reject(error);\n  }\n\n  return firebase.auth().currentUser.reload().then(function () {\n    var auth = firebase.auth().currentUser;\n    dispatch({ type: _constants.actionTypes.AUTH_RELOAD_SUCCESS, payload: auth });\n    return auth;\n  }).catch(function (error) {\n    dispatch({ type: _constants.actionTypes.AUTH_RELOAD_ERROR, error: error });\n    return Promise.reject(error);\n  });\n};\n\nvar linkWithCredential = exports.linkWithCredential = function linkWithCredential(dispatch, firebase, credential) {\n  dispatch({ type: _constants.actionTypes.AUTH_LINK_START });\n\n  if (!firebase.auth().currentUser) {\n    var error = new Error('User must be logged in to link with credential.');\n    dispatch({ type: _constants.actionTypes.AUTH_LINK_ERROR, error: error });\n    return Promise.reject(error);\n  }\n\n  return firebase.auth().currentUser.linkWithCredential(credential).then(function (auth) {\n    dispatch({ type: _constants.actionTypes.AUTH_LINK_SUCCESS, payload: auth });\n    return auth;\n  }).catch(function (error) {\n    dispatch({ type: _constants.actionTypes.AUTH_LINK_ERROR, error: error });\n    return Promise.reject(error);\n  });\n};\n\nfunction linkWithAuthDispatch(promiseFunc, args, dispatch, firebase) {\n  dispatch({ type: _constants.actionTypes.AUTH_LINK_START });\n\n  if (!firebase.auth().currentUser) {\n    var error = new Error('User must be logged in to link with credential.');\n    dispatch({ type: _constants.actionTypes.AUTH_LINK_ERROR, error: error });\n    return Promise.reject(error);\n  }\n\n  return promiseFunc.apply(undefined, _toConsumableArray(args)).then(function (auth) {\n    dispatch({ type: _constants.actionTypes.AUTH_LINK_SUCCESS, payload: auth });\n    return auth;\n  }).catch(function (error) {\n    dispatch({ type: _constants.actionTypes.AUTH_LINK_ERROR, error: error });\n    return Promise.reject(error);\n  });\n}\n\nfunction linkAndRetrieveDataWithCredential(dispatch, firebase, credential) {\n  return linkWithAuthDispatch(firebase.auth().currentUser.linkAndRetrieveDataWithCredential, [credential], dispatch, firebase);\n}\n\nfunction linkWithPopup(dispatch, firebase, credential) {\n  return linkWithAuthDispatch(firebase.auth().currentUser.linkWithPopup, [credential], dispatch, firebase);\n}\n\nfunction linkWithRedirect(dispatch, firebase, provider) {\n  return linkWithAuthDispatch(firebase.auth().currentUser.linkWithRedirect, [provider], dispatch, firebase);\n}\n\nvar signInWithPhoneNumber = exports.signInWithPhoneNumber = function signInWithPhoneNumber(firebase, dispatch, phoneNumber, applicationVerifier) {\n  var options = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {};\n\n  return login(dispatch, firebase, _extends({\n    phoneNumber: phoneNumber,\n    applicationVerifier: applicationVerifier\n  }, options));\n};\n\nexports.default = {\n  dispatchLoginError: dispatchLoginError,\n  unWatchUserProfile: unWatchUserProfile,\n  watchUserProfile: watchUserProfile,\n  init: init,\n  createUserProfile: createUserProfile,\n  login: login,\n  logout: logout,\n  createUser: createUser,\n  resetPassword: resetPassword,\n  confirmPasswordReset: confirmPasswordReset,\n  verifyPasswordResetCode: verifyPasswordResetCode,\n  updateAuth: updateAuth,\n  updateProfile: updateProfile,\n  updateEmail: updateEmail,\n  reloadAuth: reloadAuth,\n  signInWithPhoneNumber: signInWithPhoneNumber\n};"]},"metadata":{},"sourceType":"script"}