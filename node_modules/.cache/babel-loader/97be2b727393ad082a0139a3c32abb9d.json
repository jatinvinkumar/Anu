{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.signInWithPhoneNumber = exports.linkWithCredential = exports.reloadAuth = exports.updateEmail = exports.updateAuth = exports.updateProfile = exports.verifyPasswordResetCode = exports.confirmPasswordReset = exports.resetPassword = exports.createUser = exports.logout = exports.login = exports.init = exports.handleRedirectResult = exports.createUserProfile = exports.watchUserProfile = exports.handleProfileWatchResponse = exports.unWatchUserProfile = undefined;\n\nvar _pick2 = require('lodash/pick');\n\nvar _pick3 = _interopRequireDefault(_pick2);\n\nvar _omit2 = require('lodash/omit');\n\nvar _omit3 = _interopRequireDefault(_omit2);\n\nvar _forEach2 = require('lodash/forEach');\n\nvar _forEach3 = _interopRequireDefault(_forEach2);\n\nvar _isFunction2 = require('lodash/isFunction');\n\nvar _isFunction3 = _interopRequireDefault(_isFunction2);\n\nvar _isString2 = require('lodash/isString');\n\nvar _isString3 = _interopRequireDefault(_isString2);\n\nvar _isArray2 = require('lodash/isArray');\n\nvar _isArray3 = _interopRequireDefault(_isArray2);\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nvar _constants = require('../constants');\n\nvar _helpers = require('../helpers');\n\nvar _auth = require('../utils/auth');\n\nvar _populate = require('../utils/populate');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _toConsumableArray(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  } else {\n    return Array.from(arr);\n  }\n}\n\nvar dispatchLoginError = function dispatchLoginError(dispatch, authError) {\n  return dispatch({\n    type: _constants.actionTypes.LOGIN_ERROR,\n    authError: authError\n  });\n};\n\nvar unWatchUserProfile = exports.unWatchUserProfile = function unWatchUserProfile(firebase) {\n  var _firebase$_ = firebase._,\n      authUid = _firebase$_.authUid,\n      _firebase$_$config = _firebase$_.config,\n      userProfile = _firebase$_$config.userProfile,\n      useFirestoreForProfile = _firebase$_$config.useFirestoreForProfile;\n\n  if (firebase._.profileWatch) {\n    if (useFirestoreForProfile && firebase.firestore) {\n      firebase._.profileWatch();\n    } else {\n      firebase.database().ref().child(userProfile + '/' + authUid).off('value', firebase._.profileWatch);\n    }\n\n    firebase._.profileWatch = null;\n  }\n};\n\nvar getProfileFromSnap = function getProfileFromSnap(snap) {\n  if (snap && snap.val) {\n    return snap.val();\n  }\n\n  if (snap && snap.data && snap.exists) {\n    return snap.data();\n  }\n\n  return null;\n};\n\nvar handleProfileWatchResponse = exports.handleProfileWatchResponse = function handleProfileWatchResponse(dispatch, firebase, userProfileSnap) {\n  var _firebase$_$config2 = firebase._.config,\n      profileParamsToPopulate = _firebase$_$config2.profileParamsToPopulate,\n      autoPopulateProfile = _firebase$_$config2.autoPopulateProfile,\n      useFirestoreForProfile = _firebase$_$config2.useFirestoreForProfile,\n      logErrors = _firebase$_$config2.logErrors;\n  var profile = getProfileFromSnap(userProfileSnap);\n\n  if (!profileParamsToPopulate || useFirestoreForProfile || !(0, _isArray3.default)(profileParamsToPopulate) && !(0, _isString3.default)(profileParamsToPopulate)) {\n    if (useFirestoreForProfile && profileParamsToPopulate) {\n      console.warn('Profile population is not yet supported for Firestore');\n    }\n\n    dispatch({\n      type: _constants.actionTypes.SET_PROFILE,\n      profile: profile\n    });\n  } else {\n    (0, _populate.promisesForPopulate)(firebase, userProfileSnap.key, profile, profileParamsToPopulate).then(function (data) {\n      (0, _forEach3.default)(data, function (result, path) {\n        dispatch({\n          type: _constants.actionTypes.SET,\n          path: path,\n          data: result,\n          timestamp: Date.now(),\n          requesting: false,\n          requested: true\n        });\n      });\n\n      if (!autoPopulateProfile) {\n        dispatch({\n          type: _constants.actionTypes.SET_PROFILE,\n          profile: profile\n        });\n      } else {\n        var populates = (0, _populate.getPopulateObjs)(profileParamsToPopulate);\n\n        var _profile = userProfileSnap.val();\n\n        dispatch({\n          type: _constants.actionTypes.SET_PROFILE,\n          profile: (0, _helpers.populate)({\n            profile: _profile,\n            data: data\n          }, 'profile', populates)\n        });\n      }\n    }).catch(function (err) {\n      if (logErrors) {\n        console.error('RRF: Error retrieving data for profile population. Firebase:', err);\n      }\n\n      dispatch({\n        type: _constants.actionTypes.UNAUTHORIZED_ERROR,\n        authError: 'Error during profile population: ' + err.message\n      });\n      dispatch({\n        type: _constants.actionTypes.SET_PROFILE,\n        profile: profile\n      });\n    });\n  }\n};\n\nfunction createProfileWatchErrorHandler(dispatch, firebase) {\n  var _firebase$_$config3 = firebase._.config,\n      onProfileListenerError = _firebase$_$config3.onProfileListenerError,\n      logErrors = _firebase$_$config3.logErrors;\n  return function handleProfileError(err) {\n    if (logErrors) {\n      console.error('Error with profile listener: ' + (err.message || ''), err);\n    }\n\n    if ((0, _isFunction3.default)(onProfileListenerError)) {\n      var factoryResult = onProfileListenerError(err, firebase);\n\n      if ((0, _isFunction3.default)(factoryResult.then)) {\n        return factoryResult;\n      }\n    }\n\n    return Promise.reject(err);\n  };\n}\n\nvar watchUserProfile = exports.watchUserProfile = function watchUserProfile(dispatch, firebase) {\n  var _firebase$_2 = firebase._,\n      authUid = _firebase$_2.authUid,\n      _firebase$_2$config = _firebase$_2.config,\n      userProfile = _firebase$_2$config.userProfile,\n      useFirestoreForProfile = _firebase$_2$config.useFirestoreForProfile;\n  unWatchUserProfile(firebase);\n\n  if (userProfile) {\n    if (useFirestoreForProfile && firebase.firestore) {\n      firebase._.profileWatch = firebase.firestore().collection(userProfile).doc(authUid).onSnapshot(function (userProfileSnap) {\n        return handleProfileWatchResponse(dispatch, firebase, userProfileSnap);\n      }, createProfileWatchErrorHandler(dispatch, firebase));\n    } else if (firebase.database) {\n      firebase._.profileWatch = firebase.database().ref().child(userProfile + '/' + authUid).on('value', function (userProfileSnap) {\n        return handleProfileWatchResponse(dispatch, firebase, userProfileSnap);\n      }, createProfileWatchErrorHandler(dispatch, firebase));\n    } else {\n      throw new Error('Real Time Database or Firestore must be included to enable user profile');\n    }\n  }\n};\n\nvar createUserProfile = exports.createUserProfile = function createUserProfile(dispatch, firebase, userData, profile) {\n  var config = firebase._.config;\n\n  if (!config.userProfile || !firebase.database && !firebase.firestore) {\n    return Promise.resolve(userData);\n  }\n\n  if ((0, _isFunction3.default)(config.profileFactory)) {\n    try {\n      profile = config.profileFactory(userData, profile);\n    } catch (err) {\n      console.error('Error occured within profileFactory function:', err.message || err);\n      return Promise.reject(err);\n    }\n  }\n\n  if (config.useFirestoreForProfile) {\n    return firebase.firestore().collection(config.userProfile).doc(userData.uid || userData.user.uid).get().then(function (profileSnap) {\n      if (!config.updateProfileOnLogin && profileSnap.exists) {\n        return profileSnap.data();\n      }\n\n      var newProfile = profile;\n\n      if (!newProfile) {\n        var userDataObject = userData.uid ? userData.toJSON ? userData.toJSON() : userData : userData.user.toJSON ? userData.user.toJSON() : userData.user;\n        newProfile = _extends({}, (0, _omit3.default)(userDataObject, config.keysToRemoveFromAuth), {\n          avatarUrl: userDataObject.photoURL\n        });\n      }\n\n      if ((0, _isArray3.default)(newProfile.providerData)) {\n        newProfile.providerData = newProfile.providerData.map(function (providerDataItem) {\n          return (0, _pick3.default)(providerDataItem, config.keysToPreserveFromProviderData);\n        });\n      }\n\n      return profileSnap.ref.set(newProfile, {\n        merge: true\n      }).then(function () {\n        return newProfile;\n      });\n    }).catch(function (err) {\n      dispatch({\n        type: _constants.actionTypes.UNAUTHORIZED_ERROR,\n        authError: err\n      });\n      return Promise.reject(err);\n    });\n  }\n\n  return firebase.database().ref().child(config.userProfile + '/' + (userData.user ? userData.user.uid : userData.uid)).once('value').then(function (profileSnap) {\n    return !config.updateProfileOnLogin && profileSnap.val() !== null ? profileSnap.val() : profileSnap.ref.update(profile).then(function () {\n      return profile;\n    });\n  }).catch(function (err) {\n    dispatch({\n      type: _constants.actionTypes.UNAUTHORIZED_ERROR,\n      authError: err\n    });\n\n    if ((0, _isFunction3.default)(config.onProfileWriteError)) {\n      config.onProfileWriteError(err, firebase);\n    }\n\n    return Promise.reject(err);\n  });\n};\n\nvar handleAuthStateChange = function handleAuthStateChange(dispatch, firebase, authData) {\n  var config = firebase._.config;\n\n  if (!authData) {\n    if ((0, _isFunction3.default)(config.onAuthStateChanged)) {\n      firebase._.config.onAuthStateChanged(authData, firebase, dispatch);\n    }\n\n    dispatch({\n      type: _constants.actionTypes.AUTH_EMPTY_CHANGE,\n      preserve: config.preserveOnEmptyAuthChange\n    });\n  } else {\n    firebase._.authUid = authData.uid;\n\n    if (config.presence) {\n      (0, _auth.setupPresence)(dispatch, firebase);\n    }\n\n    dispatch({\n      type: _constants.actionTypes.LOGIN,\n      auth: authData,\n      preserve: config.preserveOnLogin\n    });\n    watchUserProfile(dispatch, firebase);\n\n    if ((0, _isFunction3.default)(config.onAuthStateChanged)) {\n      config.onAuthStateChanged(authData, firebase, dispatch);\n    }\n  }\n};\n\nvar handleRedirectResult = exports.handleRedirectResult = function handleRedirectResult(dispatch, firebase, authData) {\n  if (typeof firebase._.config.onRedirectResult === 'function') {\n    firebase._.config.onRedirectResult(authData, firebase, dispatch);\n  }\n\n  if (authData && authData.user) {\n    var user = authData.user;\n    firebase._.authUid = user.uid;\n    watchUserProfile(dispatch, firebase);\n    dispatch({\n      type: _constants.actionTypes.LOGIN,\n      auth: user,\n      preserve: firebase._.config.preserveOnLogin\n    });\n    return createUserProfile(dispatch, firebase, user, {\n      email: user.email,\n      displayName: user.providerData[0].displayName || user.email,\n      avatarUrl: user.providerData[0].photoURL,\n      providerData: user.providerData\n    });\n  }\n};\n\nvar init = exports.init = function init(dispatch, firebase) {\n  if (!firebase.auth) {\n    return;\n  }\n\n  dispatch({\n    type: _constants.actionTypes.AUTHENTICATION_INIT_STARTED\n  });\n  firebase.auth().onAuthStateChanged(function (authData) {\n    return handleAuthStateChange(dispatch, firebase, authData);\n  });\n\n  if (firebase._.config.enableRedirectHandling && (0, _isFunction3.default)(firebase.auth().getRedirectResult) && typeof window !== 'undefined' && window.location && window.location.protocol && window.location.protocol.indexOf('http') !== -1) {\n    firebase.auth().getRedirectResult().then(function (authData) {\n      return handleRedirectResult(dispatch, firebase, authData);\n    }).catch(function (error) {\n      dispatchLoginError(dispatch, error);\n      return Promise.reject(error);\n    });\n  }\n\n  firebase.auth().currentUser;\n  dispatch({\n    type: _constants.actionTypes.AUTHENTICATION_INIT_FINISHED\n  });\n};\n\nvar login = exports.login = function login(dispatch, firebase, credentials) {\n  var _firebase$auth;\n\n  if (firebase._.config.resetBeforeLogin) {\n    dispatchLoginError(dispatch, null);\n  }\n\n  var _getLoginMethodAndPar = (0, _auth.getLoginMethodAndParams)(firebase, credentials),\n      method = _getLoginMethodAndPar.method,\n      params = _getLoginMethodAndPar.params;\n\n  return (_firebase$auth = firebase.auth())[method].apply(_firebase$auth, _toConsumableArray(params)).then(function (userData) {\n    if (!userData) return Promise.resolve(null);\n\n    if (['signInWithEmailAndPassword', 'signInAndRetrieveDataWithEmailAndPassword'].includes(method)) {\n      return {\n        user: userData\n      };\n    }\n\n    if (['signInWithCustomToken', 'signInAndRetrieveDataWithCustomToken'].includes(method)) {\n      if (!firebase._.config.updateProfileOnLogin) {\n        return {\n          user: userData\n        };\n      }\n\n      return createUserProfile(dispatch, firebase, userData, credentials.profile);\n    }\n\n    if (method === 'signInWithPhoneNumber') {\n      return _extends({}, userData, {\n        confirm: function confirm(code) {\n          return userData.confirm(code).then(function (_ref) {\n            var user = _ref.user,\n                additionalUserInfo = _ref.additionalUserInfo;\n            return createUserProfile(dispatch, firebase, user, {\n              phoneNumber: user.providerData[0].phoneNumber,\n              providerData: user.providerData\n            }).then(function (profile) {\n              return {\n                profile: profile,\n                user: user,\n                additionalUserInfo: additionalUserInfo\n              };\n            });\n          });\n        }\n      });\n    }\n\n    var user = userData.user || userData;\n    return createUserProfile(dispatch, firebase, user, credentials.profile || {\n      email: user.email,\n      displayName: user.providerData[0].displayName || user.email,\n      avatarUrl: user.providerData[0].photoURL,\n      providerData: user.providerData\n    }).then(function (profile) {\n      return _extends({\n        profile: profile\n      }, userData);\n    });\n  }).catch(function (err) {\n    dispatchLoginError(dispatch, err);\n    return Promise.reject(err);\n  });\n};\n\nvar logout = exports.logout = function logout(dispatch, firebase) {\n  unWatchUserProfile(firebase);\n  return firebase.auth().signOut().then(function () {\n    var action = {\n      type: _constants.actionTypes.LOGOUT\n    };\n\n    if (firebase._.config.preserveOnLogout) {\n      action.preserve = firebase._.config.preserveOnLogout;\n    }\n\n    dispatch(action);\n    firebase._.authUid = null;\n    return firebase;\n  });\n};\n\nvar createUser = exports.createUser = function createUser(dispatch, firebase, _ref2, profile) {\n  var email = _ref2.email,\n      password = _ref2.password,\n      signIn = _ref2.signIn;\n  dispatchLoginError(dispatch, null);\n\n  if (!email || !password) {\n    var error = new Error('Email and Password are required to create user');\n    dispatchLoginError(dispatch, error);\n    return Promise.reject(error);\n  }\n\n  return firebase.auth().createUserWithEmailAndPassword(email, password).then(function (userData) {\n    return firebase.auth().currentUser || !!signIn && signIn === false ? createUserProfile(dispatch, firebase, userData, profile || {\n      email: email\n    }) : login(dispatch, firebase, {\n      email: email,\n      password: password\n    }).then(function () {\n      return createUserProfile(dispatch, firebase, userData, profile || {\n        email: email\n      });\n    }).catch(function (err) {\n      if (err) {\n        switch (err.code) {\n          case 'auth/user-not-found':\n            dispatchLoginError(dispatch, new Error('The specified user account does not exist.'));\n            break;\n\n          default:\n            dispatchLoginError(dispatch, err);\n        }\n      }\n\n      return Promise.reject(err);\n    });\n  }).catch(function (err) {\n    dispatchLoginError(dispatch, err);\n    return Promise.reject(err);\n  });\n};\n\nvar resetPassword = exports.resetPassword = function resetPassword(dispatch, firebase, email) {\n  dispatchLoginError(dispatch, null);\n  return firebase.auth().sendPasswordResetEmail(email).catch(function (err) {\n    if (err) {\n      switch (err.code) {\n        case 'auth/user-not-found':\n          dispatchLoginError(dispatch, new Error('The specified user account does not exist.'));\n          break;\n\n        default:\n          dispatchLoginError(dispatch, err);\n      }\n\n      return Promise.reject(err);\n    }\n  });\n};\n\nvar confirmPasswordReset = exports.confirmPasswordReset = function confirmPasswordReset(dispatch, firebase, code, password) {\n  dispatchLoginError(dispatch, null);\n  return firebase.auth().confirmPasswordReset(code, password).catch(function (err) {\n    if (err) {\n      switch (err.code) {\n        case 'auth/expired-action-code':\n          dispatchLoginError(dispatch, new Error('The action code has expired.'));\n          break;\n\n        case 'auth/invalid-action-code':\n          dispatchLoginError(dispatch, new Error('The action code is invalid.'));\n          break;\n\n        case 'auth/user-disabled':\n          dispatchLoginError(dispatch, new Error('The user is disabled.'));\n          break;\n\n        case 'auth/user-not-found':\n          dispatchLoginError(dispatch, new Error('The user is not found.'));\n          break;\n\n        case 'auth/weak-password':\n          dispatchLoginError(dispatch, new Error('The password is not strong enough.'));\n          break;\n\n        default:\n          dispatchLoginError(dispatch, err);\n      }\n\n      return Promise.reject(err);\n    }\n  });\n};\n\nvar verifyPasswordResetCode = exports.verifyPasswordResetCode = function verifyPasswordResetCode(dispatch, firebase, code) {\n  dispatchLoginError(dispatch, null);\n  return firebase.auth().verifyPasswordResetCode(code).catch(function (err) {\n    if (err) {\n      dispatchLoginError(dispatch, err);\n    }\n\n    return Promise.reject(err);\n  });\n};\n\nvar updateProfile = exports.updateProfile = function updateProfile(dispatch, firebase, profileUpdate) {\n  var config = firebase._.config;\n  dispatch({\n    type: _constants.actionTypes.PROFILE_UPDATE_START,\n    payload: profileUpdate\n  });\n  var updatePromise = config.useFirestoreForProfile ? _auth.updateProfileOnFirestore : _auth.updateProfileOnRTDB;\n  return updatePromise(firebase, profileUpdate).then(function (snap) {\n    dispatch({\n      type: _constants.actionTypes.PROFILE_UPDATE_SUCCESS,\n      payload: config.useFirestoreForProfile ? snap.data() : snap.val()\n    });\n    return snap;\n  }).catch(function (error) {\n    dispatch({\n      type: _constants.actionTypes.PROFILE_UPDATE_ERROR,\n      error: error\n    });\n    return Promise.reject(error);\n  });\n};\n\nvar updateAuth = exports.updateAuth = function updateAuth(dispatch, firebase, authUpdate, updateInProfile) {\n  dispatch({\n    type: _constants.actionTypes.AUTH_UPDATE_START,\n    payload: authUpdate\n  });\n\n  if (!firebase.auth().currentUser) {\n    var error = new Error('User must be logged in to update auth.');\n    dispatch({\n      type: _constants.actionTypes.AUTH_UPDATE_ERROR,\n      payload: error\n    });\n    return Promise.reject(error);\n  }\n\n  return firebase.auth().currentUser.updateProfile(authUpdate).then(function (payload) {\n    dispatch({\n      type: _constants.actionTypes.AUTH_UPDATE_SUCCESS,\n      auth: firebase.auth().currentUser\n    });\n\n    if (updateInProfile) {\n      return updateProfile(dispatch, firebase, authUpdate);\n    }\n\n    return payload;\n  }).catch(function (error) {\n    dispatch({\n      type: _constants.actionTypes.AUTH_UPDATE_ERROR,\n      error: error\n    });\n    return Promise.reject(error);\n  });\n};\n\nvar updateEmail = exports.updateEmail = function updateEmail(dispatch, firebase, newEmail, updateInProfile) {\n  dispatch({\n    type: _constants.actionTypes.EMAIL_UPDATE_START,\n    payload: newEmail\n  });\n\n  if (!firebase.auth().currentUser) {\n    var error = new Error('User must be logged in to update email.');\n    dispatch({\n      type: _constants.actionTypes.EMAIL_UPDATE_ERROR,\n      error: error\n    });\n    return Promise.reject(error);\n  }\n\n  return firebase.auth().currentUser.updateEmail(newEmail).then(function (payload) {\n    dispatch({\n      type: _constants.actionTypes.EMAIL_UPDATE_SUCCESS,\n      payload: newEmail\n    });\n\n    if (updateInProfile) {\n      return updateProfile(dispatch, firebase, {\n        email: newEmail\n      });\n    }\n\n    return payload;\n  }).catch(function (error) {\n    dispatch({\n      type: _constants.actionTypes.EMAIL_UPDATE_ERROR,\n      error: error\n    });\n    return Promise.reject(error);\n  });\n};\n\nvar reloadAuth = exports.reloadAuth = function reloadAuth(dispatch, firebase) {\n  dispatch({\n    type: _constants.actionTypes.AUTH_RELOAD_START\n  });\n\n  if (!firebase.auth().currentUser) {\n    var error = new Error('User must be logged in to reload auth.');\n    dispatch({\n      type: _constants.actionTypes.AUTH_RELOAD_ERROR,\n      error: error\n    });\n    return Promise.reject(error);\n  }\n\n  return firebase.auth().currentUser.reload().then(function () {\n    var auth = firebase.auth().currentUser;\n    dispatch({\n      type: _constants.actionTypes.AUTH_RELOAD_SUCCESS,\n      payload: auth\n    });\n    return auth;\n  }).catch(function (error) {\n    dispatch({\n      type: _constants.actionTypes.AUTH_RELOAD_ERROR,\n      error: error\n    });\n    return Promise.reject(error);\n  });\n};\n\nvar linkWithCredential = exports.linkWithCredential = function linkWithCredential(dispatch, firebase, credential) {\n  dispatch({\n    type: _constants.actionTypes.AUTH_LINK_START\n  });\n\n  if (!firebase.auth().currentUser) {\n    var error = new Error('User must be logged in to link with credential.');\n    dispatch({\n      type: _constants.actionTypes.AUTH_LINK_ERROR,\n      error: error\n    });\n    return Promise.reject(error);\n  }\n\n  return firebase.auth().currentUser.linkWithCredential(credential).then(function (auth) {\n    dispatch({\n      type: _constants.actionTypes.AUTH_LINK_SUCCESS,\n      payload: auth\n    });\n    return auth;\n  }).catch(function (error) {\n    dispatch({\n      type: _constants.actionTypes.AUTH_LINK_ERROR,\n      error: error\n    });\n    return Promise.reject(error);\n  });\n};\n\nvar signInWithPhoneNumber = exports.signInWithPhoneNumber = function signInWithPhoneNumber(firebase, dispatch, phoneNumber, applicationVerifier) {\n  var options = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {};\n  return login(dispatch, firebase, _extends({\n    phoneNumber: phoneNumber,\n    applicationVerifier: applicationVerifier\n  }, options));\n};\n\nexports.default = {\n  dispatchLoginError: dispatchLoginError,\n  unWatchUserProfile: unWatchUserProfile,\n  watchUserProfile: watchUserProfile,\n  init: init,\n  createUserProfile: createUserProfile,\n  login: login,\n  logout: logout,\n  createUser: createUser,\n  resetPassword: resetPassword,\n  confirmPasswordReset: confirmPasswordReset,\n  verifyPasswordResetCode: verifyPasswordResetCode,\n  updateAuth: updateAuth,\n  updateProfile: updateProfile,\n  updateEmail: updateEmail,\n  reloadAuth: reloadAuth,\n  signInWithPhoneNumber: signInWithPhoneNumber\n};","map":{"version":3,"sources":["/Users/jatinkumar/Desktop/react-material-dashboard-master/node_modules/react-redux-firebase/es/actions/auth.js"],"names":["Object","defineProperty","exports","value","signInWithPhoneNumber","linkWithCredential","reloadAuth","updateEmail","updateAuth","updateProfile","verifyPasswordResetCode","confirmPasswordReset","resetPassword","createUser","logout","login","init","handleRedirectResult","createUserProfile","watchUserProfile","handleProfileWatchResponse","unWatchUserProfile","undefined","_pick2","require","_pick3","_interopRequireDefault","_omit2","_omit3","_forEach2","_forEach3","_isFunction2","_isFunction3","_isString2","_isString3","_isArray2","_isArray3","_extends","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","_constants","_helpers","_auth","_populate","obj","__esModule","default","_toConsumableArray","arr","Array","isArray","arr2","from","dispatchLoginError","dispatch","authError","type","actionTypes","LOGIN_ERROR","firebase","_firebase$_","_","authUid","_firebase$_$config","config","userProfile","useFirestoreForProfile","profileWatch","firestore","database","ref","child","off","getProfileFromSnap","snap","val","data","exists","userProfileSnap","_firebase$_$config2","profileParamsToPopulate","autoPopulateProfile","logErrors","profile","console","warn","SET_PROFILE","promisesForPopulate","then","result","path","SET","timestamp","Date","now","requesting","requested","populates","getPopulateObjs","_profile","populate","catch","err","error","UNAUTHORIZED_ERROR","message","createProfileWatchErrorHandler","_firebase$_$config3","onProfileListenerError","handleProfileError","factoryResult","Promise","reject","_firebase$_2","_firebase$_2$config","collection","doc","onSnapshot","on","Error","userData","resolve","profileFactory","uid","user","get","profileSnap","updateProfileOnLogin","newProfile","userDataObject","toJSON","keysToRemoveFromAuth","avatarUrl","photoURL","providerData","map","providerDataItem","keysToPreserveFromProviderData","set","merge","once","update","onProfileWriteError","handleAuthStateChange","authData","onAuthStateChanged","AUTH_EMPTY_CHANGE","preserve","preserveOnEmptyAuthChange","presence","setupPresence","LOGIN","auth","preserveOnLogin","onRedirectResult","email","displayName","AUTHENTICATION_INIT_STARTED","enableRedirectHandling","getRedirectResult","window","location","protocol","indexOf","currentUser","AUTHENTICATION_INIT_FINISHED","credentials","_firebase$auth","resetBeforeLogin","_getLoginMethodAndPar","getLoginMethodAndParams","method","params","apply","includes","confirm","code","_ref","additionalUserInfo","phoneNumber","signOut","action","LOGOUT","preserveOnLogout","_ref2","password","signIn","createUserWithEmailAndPassword","sendPasswordResetEmail","profileUpdate","PROFILE_UPDATE_START","payload","updatePromise","updateProfileOnFirestore","updateProfileOnRTDB","PROFILE_UPDATE_SUCCESS","PROFILE_UPDATE_ERROR","authUpdate","updateInProfile","AUTH_UPDATE_START","AUTH_UPDATE_ERROR","AUTH_UPDATE_SUCCESS","newEmail","EMAIL_UPDATE_START","EMAIL_UPDATE_ERROR","EMAIL_UPDATE_SUCCESS","AUTH_RELOAD_START","AUTH_RELOAD_ERROR","reload","AUTH_RELOAD_SUCCESS","credential","AUTH_LINK_START","AUTH_LINK_ERROR","AUTH_LINK_SUCCESS","applicationVerifier","options"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.signInWithPhoneNumber = exports.linkWithCredential = exports.reloadAuth = exports.updateEmail = exports.updateAuth = exports.updateProfile = exports.verifyPasswordResetCode = exports.confirmPasswordReset = exports.resetPassword = exports.createUser = exports.logout = exports.login = exports.init = exports.handleRedirectResult = exports.createUserProfile = exports.watchUserProfile = exports.handleProfileWatchResponse = exports.unWatchUserProfile = undefined;\n\nvar _pick2 = require('lodash/pick');\n\nvar _pick3 = _interopRequireDefault(_pick2);\n\nvar _omit2 = require('lodash/omit');\n\nvar _omit3 = _interopRequireDefault(_omit2);\n\nvar _forEach2 = require('lodash/forEach');\n\nvar _forEach3 = _interopRequireDefault(_forEach2);\n\nvar _isFunction2 = require('lodash/isFunction');\n\nvar _isFunction3 = _interopRequireDefault(_isFunction2);\n\nvar _isString2 = require('lodash/isString');\n\nvar _isString3 = _interopRequireDefault(_isString2);\n\nvar _isArray2 = require('lodash/isArray');\n\nvar _isArray3 = _interopRequireDefault(_isArray2);\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nvar _constants = require('../constants');\n\nvar _helpers = require('../helpers');\n\nvar _auth = require('../utils/auth');\n\nvar _populate = require('../utils/populate');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nvar dispatchLoginError = function dispatchLoginError(dispatch, authError) {\n  return dispatch({\n    type: _constants.actionTypes.LOGIN_ERROR,\n    authError: authError\n  });\n};\n\nvar unWatchUserProfile = exports.unWatchUserProfile = function unWatchUserProfile(firebase) {\n  var _firebase$_ = firebase._,\n      authUid = _firebase$_.authUid,\n      _firebase$_$config = _firebase$_.config,\n      userProfile = _firebase$_$config.userProfile,\n      useFirestoreForProfile = _firebase$_$config.useFirestoreForProfile;\n\n  if (firebase._.profileWatch) {\n    if (useFirestoreForProfile && firebase.firestore) {\n      firebase._.profileWatch();\n    } else {\n      firebase.database().ref().child(userProfile + '/' + authUid).off('value', firebase._.profileWatch);\n    }\n    firebase._.profileWatch = null;\n  }\n};\n\nvar getProfileFromSnap = function getProfileFromSnap(snap) {\n  if (snap && snap.val) {\n    return snap.val();\n  }\n\n  if (snap && snap.data && snap.exists) {\n    return snap.data();\n  }\n  return null;\n};\n\nvar handleProfileWatchResponse = exports.handleProfileWatchResponse = function handleProfileWatchResponse(dispatch, firebase, userProfileSnap) {\n  var _firebase$_$config2 = firebase._.config,\n      profileParamsToPopulate = _firebase$_$config2.profileParamsToPopulate,\n      autoPopulateProfile = _firebase$_$config2.autoPopulateProfile,\n      useFirestoreForProfile = _firebase$_$config2.useFirestoreForProfile,\n      logErrors = _firebase$_$config2.logErrors;\n\n  var profile = getProfileFromSnap(userProfileSnap);\n  if (!profileParamsToPopulate || useFirestoreForProfile || !(0, _isArray3.default)(profileParamsToPopulate) && !(0, _isString3.default)(profileParamsToPopulate)) {\n    if (useFirestoreForProfile && profileParamsToPopulate) {\n      console.warn('Profile population is not yet supported for Firestore');\n    }\n    dispatch({ type: _constants.actionTypes.SET_PROFILE, profile: profile });\n  } else {\n    (0, _populate.promisesForPopulate)(firebase, userProfileSnap.key, profile, profileParamsToPopulate).then(function (data) {\n      (0, _forEach3.default)(data, function (result, path) {\n        dispatch({\n          type: _constants.actionTypes.SET,\n          path: path,\n          data: result,\n          timestamp: Date.now(),\n          requesting: false,\n          requested: true\n        });\n      });\n      if (!autoPopulateProfile) {\n        dispatch({ type: _constants.actionTypes.SET_PROFILE, profile: profile });\n      } else {\n        var populates = (0, _populate.getPopulateObjs)(profileParamsToPopulate);\n        var _profile = userProfileSnap.val();\n        dispatch({\n          type: _constants.actionTypes.SET_PROFILE,\n          profile: (0, _helpers.populate)({ profile: _profile, data: data }, 'profile', populates)\n        });\n      }\n    }).catch(function (err) {\n      if (logErrors) {\n        console.error('RRF: Error retrieving data for profile population. Firebase:', err);\n      }\n\n      dispatch({\n        type: _constants.actionTypes.UNAUTHORIZED_ERROR,\n        authError: 'Error during profile population: ' + err.message\n      });\n\n      dispatch({ type: _constants.actionTypes.SET_PROFILE, profile: profile });\n    });\n  }\n};\n\nfunction createProfileWatchErrorHandler(dispatch, firebase) {\n  var _firebase$_$config3 = firebase._.config,\n      onProfileListenerError = _firebase$_$config3.onProfileListenerError,\n      logErrors = _firebase$_$config3.logErrors;\n\n  return function handleProfileError(err) {\n    if (logErrors) {\n      console.error('Error with profile listener: ' + (err.message || ''), err);\n    }\n    if ((0, _isFunction3.default)(onProfileListenerError)) {\n      var factoryResult = onProfileListenerError(err, firebase);\n\n      if ((0, _isFunction3.default)(factoryResult.then)) {\n        return factoryResult;\n      }\n    }\n    return Promise.reject(err);\n  };\n}\n\nvar watchUserProfile = exports.watchUserProfile = function watchUserProfile(dispatch, firebase) {\n  var _firebase$_2 = firebase._,\n      authUid = _firebase$_2.authUid,\n      _firebase$_2$config = _firebase$_2.config,\n      userProfile = _firebase$_2$config.userProfile,\n      useFirestoreForProfile = _firebase$_2$config.useFirestoreForProfile;\n\n  unWatchUserProfile(firebase);\n\n  if (userProfile) {\n    if (useFirestoreForProfile && firebase.firestore) {\n      firebase._.profileWatch = firebase.firestore().collection(userProfile).doc(authUid).onSnapshot(function (userProfileSnap) {\n        return handleProfileWatchResponse(dispatch, firebase, userProfileSnap);\n      }, createProfileWatchErrorHandler(dispatch, firebase));\n    } else if (firebase.database) {\n      firebase._.profileWatch = firebase.database().ref().child(userProfile + '/' + authUid).on('value', function (userProfileSnap) {\n        return handleProfileWatchResponse(dispatch, firebase, userProfileSnap);\n      }, createProfileWatchErrorHandler(dispatch, firebase));\n    } else {\n      throw new Error('Real Time Database or Firestore must be included to enable user profile');\n    }\n  }\n};\n\nvar createUserProfile = exports.createUserProfile = function createUserProfile(dispatch, firebase, userData, profile) {\n  var config = firebase._.config;\n\n  if (!config.userProfile || !firebase.database && !firebase.firestore) {\n    return Promise.resolve(userData);\n  }\n\n  if ((0, _isFunction3.default)(config.profileFactory)) {\n    try {\n      profile = config.profileFactory(userData, profile);\n    } catch (err) {\n      console.error('Error occured within profileFactory function:', err.message || err);\n\n      return Promise.reject(err);\n    }\n  }\n\n  if (config.useFirestoreForProfile) {\n    return firebase.firestore().collection(config.userProfile).doc(userData.uid || userData.user.uid).get().then(function (profileSnap) {\n      if (!config.updateProfileOnLogin && profileSnap.exists) {\n        return profileSnap.data();\n      }\n      var newProfile = profile;\n\n      if (!newProfile) {\n        var userDataObject = userData.uid ? userData.toJSON ? userData.toJSON() : userData : userData.user.toJSON ? userData.user.toJSON() : userData.user;\n\n        newProfile = _extends({}, (0, _omit3.default)(userDataObject, config.keysToRemoveFromAuth), {\n          avatarUrl: userDataObject.photoURL });\n      }\n\n      if ((0, _isArray3.default)(newProfile.providerData)) {\n        newProfile.providerData = newProfile.providerData.map(function (providerDataItem) {\n          return (0, _pick3.default)(providerDataItem, config.keysToPreserveFromProviderData);\n        });\n      }\n\n      return profileSnap.ref.set(newProfile, { merge: true }).then(function () {\n        return newProfile;\n      });\n    }).catch(function (err) {\n      dispatch({ type: _constants.actionTypes.UNAUTHORIZED_ERROR, authError: err });\n      return Promise.reject(err);\n    });\n  }\n\n  return firebase.database().ref().child(config.userProfile + '/' + (userData.user ? userData.user.uid : userData.uid)).once('value').then(function (profileSnap) {\n    return !config.updateProfileOnLogin && profileSnap.val() !== null ? profileSnap.val() : profileSnap.ref.update(profile).then(function () {\n      return profile;\n    });\n  }).catch(function (err) {\n    dispatch({ type: _constants.actionTypes.UNAUTHORIZED_ERROR, authError: err });\n    if ((0, _isFunction3.default)(config.onProfileWriteError)) {\n      config.onProfileWriteError(err, firebase);\n    }\n    return Promise.reject(err);\n  });\n};\n\nvar handleAuthStateChange = function handleAuthStateChange(dispatch, firebase, authData) {\n  var config = firebase._.config;\n\n  if (!authData) {\n    if ((0, _isFunction3.default)(config.onAuthStateChanged)) {\n      firebase._.config.onAuthStateChanged(authData, firebase, dispatch);\n    }\n    dispatch({\n      type: _constants.actionTypes.AUTH_EMPTY_CHANGE,\n      preserve: config.preserveOnEmptyAuthChange\n    });\n  } else {\n    firebase._.authUid = authData.uid;\n    if (config.presence) {\n      (0, _auth.setupPresence)(dispatch, firebase);\n    }\n\n    dispatch({\n      type: _constants.actionTypes.LOGIN,\n      auth: authData,\n      preserve: config.preserveOnLogin\n    });\n\n    watchUserProfile(dispatch, firebase);\n\n    if ((0, _isFunction3.default)(config.onAuthStateChanged)) {\n      config.onAuthStateChanged(authData, firebase, dispatch);\n    }\n  }\n};\n\nvar handleRedirectResult = exports.handleRedirectResult = function handleRedirectResult(dispatch, firebase, authData) {\n  if (typeof firebase._.config.onRedirectResult === 'function') {\n    firebase._.config.onRedirectResult(authData, firebase, dispatch);\n  }\n  if (authData && authData.user) {\n    var user = authData.user;\n\n\n    firebase._.authUid = user.uid;\n    watchUserProfile(dispatch, firebase);\n\n    dispatch({\n      type: _constants.actionTypes.LOGIN,\n      auth: user,\n      preserve: firebase._.config.preserveOnLogin\n    });\n\n    return createUserProfile(dispatch, firebase, user, {\n      email: user.email,\n      displayName: user.providerData[0].displayName || user.email,\n      avatarUrl: user.providerData[0].photoURL,\n      providerData: user.providerData\n    });\n  }\n};\n\nvar init = exports.init = function init(dispatch, firebase) {\n  if (!firebase.auth) {\n    return;\n  }\n  dispatch({ type: _constants.actionTypes.AUTHENTICATION_INIT_STARTED });\n\n  firebase.auth().onAuthStateChanged(function (authData) {\n    return handleAuthStateChange(dispatch, firebase, authData);\n  });\n\n  if (firebase._.config.enableRedirectHandling && (0, _isFunction3.default)(firebase.auth().getRedirectResult) && typeof window !== 'undefined' && window.location && window.location.protocol && window.location.protocol.indexOf('http') !== -1) {\n    firebase.auth().getRedirectResult().then(function (authData) {\n      return handleRedirectResult(dispatch, firebase, authData);\n    }).catch(function (error) {\n      dispatchLoginError(dispatch, error);\n      return Promise.reject(error);\n    });\n  }\n\n  firebase.auth().currentUser;\n\n  dispatch({ type: _constants.actionTypes.AUTHENTICATION_INIT_FINISHED });\n};\n\nvar login = exports.login = function login(dispatch, firebase, credentials) {\n  var _firebase$auth;\n\n  if (firebase._.config.resetBeforeLogin) {\n    dispatchLoginError(dispatch, null);\n  }\n\n  var _getLoginMethodAndPar = (0, _auth.getLoginMethodAndParams)(firebase, credentials),\n      method = _getLoginMethodAndPar.method,\n      params = _getLoginMethodAndPar.params;\n\n  return (_firebase$auth = firebase.auth())[method].apply(_firebase$auth, _toConsumableArray(params)).then(function (userData) {\n    if (!userData) return Promise.resolve(null);\n\n    if (['signInWithEmailAndPassword', 'signInAndRetrieveDataWithEmailAndPassword'].includes(method)) {\n      return { user: userData };\n    }\n\n    if (['signInWithCustomToken', 'signInAndRetrieveDataWithCustomToken'].includes(method)) {\n      if (!firebase._.config.updateProfileOnLogin) {\n        return { user: userData };\n      }\n      return createUserProfile(dispatch, firebase, userData, credentials.profile);\n    }\n\n    if (method === 'signInWithPhoneNumber') {\n      return _extends({}, userData, {\n        confirm: function confirm(code) {\n          return userData.confirm(code).then(function (_ref) {\n            var user = _ref.user,\n                additionalUserInfo = _ref.additionalUserInfo;\n            return createUserProfile(dispatch, firebase, user, {\n              phoneNumber: user.providerData[0].phoneNumber,\n              providerData: user.providerData\n            }).then(function (profile) {\n              return { profile: profile, user: user, additionalUserInfo: additionalUserInfo };\n            });\n          });\n        }\n      });\n    }\n\n    var user = userData.user || userData;\n\n    return createUserProfile(dispatch, firebase, user, credentials.profile || {\n      email: user.email,\n      displayName: user.providerData[0].displayName || user.email,\n      avatarUrl: user.providerData[0].photoURL,\n      providerData: user.providerData\n    }).then(function (profile) {\n      return _extends({ profile: profile }, userData);\n    });\n  }).catch(function (err) {\n    dispatchLoginError(dispatch, err);\n    return Promise.reject(err);\n  });\n};\n\nvar logout = exports.logout = function logout(dispatch, firebase) {\n  unWatchUserProfile(firebase);\n  return firebase.auth().signOut().then(function () {\n    var action = {\n      type: _constants.actionTypes.LOGOUT\n    };\n    if (firebase._.config.preserveOnLogout) {\n      action.preserve = firebase._.config.preserveOnLogout;\n    }\n    dispatch(action);\n    firebase._.authUid = null;\n    return firebase;\n  });\n};\n\nvar createUser = exports.createUser = function createUser(dispatch, firebase, _ref2, profile) {\n  var email = _ref2.email,\n      password = _ref2.password,\n      signIn = _ref2.signIn;\n\n  dispatchLoginError(dispatch, null);\n\n  if (!email || !password) {\n    var error = new Error('Email and Password are required to create user');\n    dispatchLoginError(dispatch, error);\n    return Promise.reject(error);\n  }\n\n  return firebase.auth().createUserWithEmailAndPassword(email, password).then(function (userData) {\n    return firebase.auth().currentUser || !!signIn && signIn === false ? createUserProfile(dispatch, firebase, userData, profile || { email: email }) : login(dispatch, firebase, { email: email, password: password }).then(function () {\n      return createUserProfile(dispatch, firebase, userData, profile || { email: email });\n    }).catch(function (err) {\n      if (err) {\n        switch (err.code) {\n          case 'auth/user-not-found':\n            dispatchLoginError(dispatch, new Error('The specified user account does not exist.'));\n            break;\n          default:\n            dispatchLoginError(dispatch, err);\n        }\n      }\n      return Promise.reject(err);\n    });\n  }).catch(function (err) {\n    dispatchLoginError(dispatch, err);\n    return Promise.reject(err);\n  });\n};\n\nvar resetPassword = exports.resetPassword = function resetPassword(dispatch, firebase, email) {\n  dispatchLoginError(dispatch, null);\n  return firebase.auth().sendPasswordResetEmail(email).catch(function (err) {\n    if (err) {\n      switch (err.code) {\n        case 'auth/user-not-found':\n          dispatchLoginError(dispatch, new Error('The specified user account does not exist.'));\n          break;\n        default:\n          dispatchLoginError(dispatch, err);\n      }\n      return Promise.reject(err);\n    }\n  });\n};\n\nvar confirmPasswordReset = exports.confirmPasswordReset = function confirmPasswordReset(dispatch, firebase, code, password) {\n  dispatchLoginError(dispatch, null);\n  return firebase.auth().confirmPasswordReset(code, password).catch(function (err) {\n    if (err) {\n      switch (err.code) {\n        case 'auth/expired-action-code':\n          dispatchLoginError(dispatch, new Error('The action code has expired.'));\n          break;\n        case 'auth/invalid-action-code':\n          dispatchLoginError(dispatch, new Error('The action code is invalid.'));\n          break;\n        case 'auth/user-disabled':\n          dispatchLoginError(dispatch, new Error('The user is disabled.'));\n          break;\n        case 'auth/user-not-found':\n          dispatchLoginError(dispatch, new Error('The user is not found.'));\n          break;\n        case 'auth/weak-password':\n          dispatchLoginError(dispatch, new Error('The password is not strong enough.'));\n          break;\n        default:\n          dispatchLoginError(dispatch, err);\n      }\n      return Promise.reject(err);\n    }\n  });\n};\n\nvar verifyPasswordResetCode = exports.verifyPasswordResetCode = function verifyPasswordResetCode(dispatch, firebase, code) {\n  dispatchLoginError(dispatch, null);\n  return firebase.auth().verifyPasswordResetCode(code).catch(function (err) {\n    if (err) {\n      dispatchLoginError(dispatch, err);\n    }\n    return Promise.reject(err);\n  });\n};\n\nvar updateProfile = exports.updateProfile = function updateProfile(dispatch, firebase, profileUpdate) {\n  var config = firebase._.config;\n\n  dispatch({\n    type: _constants.actionTypes.PROFILE_UPDATE_START,\n    payload: profileUpdate\n  });\n\n  var updatePromise = config.useFirestoreForProfile ? _auth.updateProfileOnFirestore : _auth.updateProfileOnRTDB;\n  return updatePromise(firebase, profileUpdate).then(function (snap) {\n    dispatch({\n      type: _constants.actionTypes.PROFILE_UPDATE_SUCCESS,\n      payload: config.useFirestoreForProfile ? snap.data() : snap.val()\n    });\n    return snap;\n  }).catch(function (error) {\n    dispatch({ type: _constants.actionTypes.PROFILE_UPDATE_ERROR, error: error });\n    return Promise.reject(error);\n  });\n};\n\nvar updateAuth = exports.updateAuth = function updateAuth(dispatch, firebase, authUpdate, updateInProfile) {\n  dispatch({ type: _constants.actionTypes.AUTH_UPDATE_START, payload: authUpdate });\n\n  if (!firebase.auth().currentUser) {\n    var error = new Error('User must be logged in to update auth.');\n    dispatch({ type: _constants.actionTypes.AUTH_UPDATE_ERROR, payload: error });\n    return Promise.reject(error);\n  }\n\n  return firebase.auth().currentUser.updateProfile(authUpdate).then(function (payload) {\n    dispatch({\n      type: _constants.actionTypes.AUTH_UPDATE_SUCCESS,\n      auth: firebase.auth().currentUser\n    });\n    if (updateInProfile) {\n      return updateProfile(dispatch, firebase, authUpdate);\n    }\n    return payload;\n  }).catch(function (error) {\n    dispatch({ type: _constants.actionTypes.AUTH_UPDATE_ERROR, error: error });\n    return Promise.reject(error);\n  });\n};\n\nvar updateEmail = exports.updateEmail = function updateEmail(dispatch, firebase, newEmail, updateInProfile) {\n  dispatch({ type: _constants.actionTypes.EMAIL_UPDATE_START, payload: newEmail });\n\n  if (!firebase.auth().currentUser) {\n    var error = new Error('User must be logged in to update email.');\n    dispatch({ type: _constants.actionTypes.EMAIL_UPDATE_ERROR, error: error });\n    return Promise.reject(error);\n  }\n\n  return firebase.auth().currentUser.updateEmail(newEmail).then(function (payload) {\n    dispatch({ type: _constants.actionTypes.EMAIL_UPDATE_SUCCESS, payload: newEmail });\n    if (updateInProfile) {\n      return updateProfile(dispatch, firebase, { email: newEmail });\n    }\n    return payload;\n  }).catch(function (error) {\n    dispatch({ type: _constants.actionTypes.EMAIL_UPDATE_ERROR, error: error });\n    return Promise.reject(error);\n  });\n};\n\nvar reloadAuth = exports.reloadAuth = function reloadAuth(dispatch, firebase) {\n  dispatch({ type: _constants.actionTypes.AUTH_RELOAD_START });\n\n  if (!firebase.auth().currentUser) {\n    var error = new Error('User must be logged in to reload auth.');\n    dispatch({ type: _constants.actionTypes.AUTH_RELOAD_ERROR, error: error });\n    return Promise.reject(error);\n  }\n\n  return firebase.auth().currentUser.reload().then(function () {\n    var auth = firebase.auth().currentUser;\n    dispatch({ type: _constants.actionTypes.AUTH_RELOAD_SUCCESS, payload: auth });\n    return auth;\n  }).catch(function (error) {\n    dispatch({ type: _constants.actionTypes.AUTH_RELOAD_ERROR, error: error });\n    return Promise.reject(error);\n  });\n};\n\nvar linkWithCredential = exports.linkWithCredential = function linkWithCredential(dispatch, firebase, credential) {\n  dispatch({ type: _constants.actionTypes.AUTH_LINK_START });\n\n  if (!firebase.auth().currentUser) {\n    var error = new Error('User must be logged in to link with credential.');\n    dispatch({ type: _constants.actionTypes.AUTH_LINK_ERROR, error: error });\n    return Promise.reject(error);\n  }\n\n  return firebase.auth().currentUser.linkWithCredential(credential).then(function (auth) {\n    dispatch({ type: _constants.actionTypes.AUTH_LINK_SUCCESS, payload: auth });\n    return auth;\n  }).catch(function (error) {\n    dispatch({ type: _constants.actionTypes.AUTH_LINK_ERROR, error: error });\n    return Promise.reject(error);\n  });\n};\n\nvar signInWithPhoneNumber = exports.signInWithPhoneNumber = function signInWithPhoneNumber(firebase, dispatch, phoneNumber, applicationVerifier) {\n  var options = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {};\n\n  return login(dispatch, firebase, _extends({\n    phoneNumber: phoneNumber,\n    applicationVerifier: applicationVerifier\n  }, options));\n};\n\nexports.default = {\n  dispatchLoginError: dispatchLoginError,\n  unWatchUserProfile: unWatchUserProfile,\n  watchUserProfile: watchUserProfile,\n  init: init,\n  createUserProfile: createUserProfile,\n  login: login,\n  logout: logout,\n  createUser: createUser,\n  resetPassword: resetPassword,\n  confirmPasswordReset: confirmPasswordReset,\n  verifyPasswordResetCode: verifyPasswordResetCode,\n  updateAuth: updateAuth,\n  updateProfile: updateProfile,\n  updateEmail: updateEmail,\n  reloadAuth: reloadAuth,\n  signInWithPhoneNumber: signInWithPhoneNumber\n};"]},"metadata":{},"sourceType":"script"}