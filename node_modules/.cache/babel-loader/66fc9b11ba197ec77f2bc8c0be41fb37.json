{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.populateAndDispatch = exports.orderedFromSnapshot = exports.applyParamsToQuery = exports.unsetWatcher = exports.getWatcherCount = exports.setWatcher = exports.getQueryIdFromPath = exports.getWatchPath = undefined;\n\nvar _isString2 = require('lodash/isString');\n\nvar _isString3 = _interopRequireDefault(_isString2);\n\nvar _size2 = require('lodash/size');\n\nvar _size3 = _interopRequireDefault(_size2);\n\nvar _forEach2 = require('lodash/forEach');\n\nvar _forEach3 = _interopRequireDefault(_forEach2);\n\nvar _isNaN2 = require('lodash/isNaN');\n\nvar _isNaN3 = _interopRequireDefault(_isNaN2);\n\nvar _constants = require('../constants');\n\nvar _populate = require('./populate');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar tryParseToNumber = function tryParseToNumber(value) {\n  var result = Number(value);\n\n  if ((0, _isNaN3.default)(result)) {\n    return value;\n  }\n\n  return result;\n};\n\nvar getWatchPath = exports.getWatchPath = function getWatchPath(event, path) {\n  if (!event || event === '' || !path) {\n    throw new Error('Event and path are required');\n  }\n\n  return event + ':' + (path.substring(0, 1) === '/' ? '' : '/') + path;\n};\n\nvar getQueryIdFromPath = exports.getQueryIdFromPath = function getQueryIdFromPath(path, event) {\n  if (!(0, _isString3.default)(path)) {\n    throw new Error('Query path must be a string');\n  }\n\n  var origPath = path;\n  var pathSplitted = path.split('#');\n  path = pathSplitted[0];\n  var isQuery = pathSplitted.length > 1;\n  var queryParams = isQuery ? pathSplitted[1].split('&') : [];\n  var queryId = isQuery ? queryParams.map(function (param) {\n    var splittedParam = param.split('=');\n\n    if (splittedParam[0] === 'queryId') {\n      return splittedParam[1];\n    }\n  }).filter(function (q) {\n    return q;\n  }) : undefined;\n  return queryId && queryId.length > 0 ? event ? event + ':/' + queryId : queryId[0] : isQuery ? origPath : undefined;\n};\n\nvar setWatcher = exports.setWatcher = function setWatcher(firebase, dispatch, event, path, queryId) {\n  var id = queryId || getQueryIdFromPath(path, event) || getWatchPath(event, path);\n\n  if (firebase._.watchers[id]) {\n    firebase._.watchers[id]++;\n  } else {\n    firebase._.watchers[id] = 1;\n  }\n\n  dispatch({\n    type: _constants.actionTypes.SET_LISTENER,\n    path: path,\n    payload: {\n      id: id\n    }\n  });\n  return firebase._.watchers[id];\n};\n\nvar getWatcherCount = exports.getWatcherCount = function getWatcherCount(firebase, event, path, queryId) {\n  var id = queryId || getQueryIdFromPath(path, event) || getWatchPath(event, path);\n  return firebase._.watchers[id];\n};\n\nvar unsetWatcher = exports.unsetWatcher = function unsetWatcher(firebase, dispatch, event, path, queryId) {\n  var id = queryId || getQueryIdFromPath(path, event) || getWatchPath(event, path);\n  path = path.split('#')[0];\n  var watchers = firebase._.watchers;\n\n  if (watchers[id] <= 1) {\n    delete watchers[id];\n\n    if (event !== 'first_child' && event !== 'once') {\n      firebase.database().ref().child(path).off(event);\n    }\n  } else if (watchers[id]) {\n    watchers[id]--;\n  }\n\n  dispatch({\n    type: _constants.actionTypes.UNSET_LISTENER,\n    path: path,\n    payload: {\n      id: id\n    }\n  });\n};\n\nvar applyParamsToQuery = exports.applyParamsToQuery = function applyParamsToQuery(queryParams, query) {\n  var doNotParse = false;\n\n  if (queryParams) {\n    queryParams.forEach(function (param) {\n      param = param.split('=');\n\n      switch (param[0]) {\n        case 'orderByValue':\n          query = query.orderByValue();\n          doNotParse = true;\n          break;\n\n        case 'orderByPriority':\n          query = query.orderByPriority();\n          doNotParse = true;\n          break;\n\n        case 'orderByKey':\n          query = query.orderByKey();\n          doNotParse = true;\n          break;\n\n        case 'orderByChild':\n          query = query.orderByChild(param[1]);\n          break;\n\n        case 'limitToFirst':\n          query = query.limitToFirst(parseInt(param[1], 10));\n          break;\n\n        case 'limitToLast':\n          query = query.limitToLast(parseInt(param[1], 10));\n          break;\n\n        case 'notParsed':\n          doNotParse = true;\n          break;\n\n        case 'parsed':\n          doNotParse = false;\n          break;\n\n        case 'equalTo':\n          var equalToParam = !doNotParse ? tryParseToNumber(param[1]) : param[1];\n          equalToParam = equalToParam === 'null' ? null : equalToParam;\n          equalToParam = equalToParam === 'false' ? false : equalToParam;\n          equalToParam = equalToParam === 'true' ? true : equalToParam;\n          query = param.length === 3 ? query.equalTo(equalToParam, param[2]) : query.equalTo(equalToParam);\n          break;\n\n        case 'startAt':\n          var startAtParam = !doNotParse ? tryParseToNumber(param[1]) : param[1];\n          startAtParam = startAtParam === 'null' ? null : startAtParam;\n          query = param.length === 3 ? query.startAt(startAtParam, param[2]) : query.startAt(startAtParam);\n          break;\n\n        case 'endAt':\n          var endAtParam = !doNotParse ? tryParseToNumber(param[1]) : param[1];\n          endAtParam = endAtParam === 'null' ? null : endAtParam;\n          query = param.length === 3 ? query.endAt(endAtParam, param[2]) : query.endAt(endAtParam);\n          break;\n      }\n    });\n  }\n\n  return query;\n};\n\nvar orderedFromSnapshot = exports.orderedFromSnapshot = function orderedFromSnapshot(snap) {\n  if (snap.hasChildren && !snap.hasChildren()) {\n    return null;\n  }\n\n  var ordered = [];\n\n  if (snap.forEach) {\n    snap.forEach(function (child) {\n      ordered.push({\n        key: child.key,\n        value: child.val()\n      });\n    });\n  }\n\n  return (0, _size3.default)(ordered) ? ordered : null;\n};\n\nvar populateAndDispatch = exports.populateAndDispatch = function populateAndDispatch(firebase, dispatch, config) {\n  var data = config.data,\n      populates = config.populates,\n      snapshot = config.snapshot,\n      path = config.path,\n      storeAs = config.storeAs;\n  return (0, _populate.promisesForPopulate)(firebase, snapshot.key, data, populates).then(function (results) {\n    (0, _forEach3.default)(results, function (result, path) {\n      dispatch({\n        type: _constants.actionTypes.MERGE,\n        path: path,\n        data: result\n      });\n    });\n    dispatch({\n      type: _constants.actionTypes.SET,\n      path: storeAs || path,\n      data: data,\n      ordered: orderedFromSnapshot(snapshot)\n    });\n    return results;\n  }).catch(function (err) {\n    dispatch({\n      type: _constants.actionTypes.ERROR,\n      payload: err\n    });\n    return Promise.reject(err);\n  });\n};","map":{"version":3,"sources":["/Users/jatinkumar/Desktop/Anupuam/node_modules/react-redux-firebase/es/utils/query.js"],"names":["Object","defineProperty","exports","value","populateAndDispatch","orderedFromSnapshot","applyParamsToQuery","unsetWatcher","getWatcherCount","setWatcher","getQueryIdFromPath","getWatchPath","undefined","_isString2","require","_isString3","_interopRequireDefault","_size2","_size3","_forEach2","_forEach3","_isNaN2","_isNaN3","_constants","_populate","obj","__esModule","default","tryParseToNumber","result","Number","event","path","Error","substring","origPath","pathSplitted","split","isQuery","length","queryParams","queryId","map","param","splittedParam","filter","q","firebase","dispatch","id","_","watchers","type","actionTypes","SET_LISTENER","payload","database","ref","child","off","UNSET_LISTENER","query","doNotParse","forEach","orderByValue","orderByPriority","orderByKey","orderByChild","limitToFirst","parseInt","limitToLast","equalToParam","equalTo","startAtParam","startAt","endAtParam","endAt","snap","hasChildren","ordered","push","key","val","config","data","populates","snapshot","storeAs","promisesForPopulate","then","results","MERGE","SET","catch","err","ERROR","Promise","reject"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.populateAndDispatch = exports.orderedFromSnapshot = exports.applyParamsToQuery = exports.unsetWatcher = exports.getWatcherCount = exports.setWatcher = exports.getQueryIdFromPath = exports.getWatchPath = undefined;\n\nvar _isString2 = require('lodash/isString');\n\nvar _isString3 = _interopRequireDefault(_isString2);\n\nvar _size2 = require('lodash/size');\n\nvar _size3 = _interopRequireDefault(_size2);\n\nvar _forEach2 = require('lodash/forEach');\n\nvar _forEach3 = _interopRequireDefault(_forEach2);\n\nvar _isNaN2 = require('lodash/isNaN');\n\nvar _isNaN3 = _interopRequireDefault(_isNaN2);\n\nvar _constants = require('../constants');\n\nvar _populate = require('./populate');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar tryParseToNumber = function tryParseToNumber(value) {\n  var result = Number(value);\n  if ((0, _isNaN3.default)(result)) {\n    return value;\n  }\n  return result;\n};\n\nvar getWatchPath = exports.getWatchPath = function getWatchPath(event, path) {\n  if (!event || event === '' || !path) {\n    throw new Error('Event and path are required');\n  }\n  return event + ':' + (path.substring(0, 1) === '/' ? '' : '/') + path;\n};\n\nvar getQueryIdFromPath = exports.getQueryIdFromPath = function getQueryIdFromPath(path, event) {\n  if (!(0, _isString3.default)(path)) {\n    throw new Error('Query path must be a string');\n  }\n  var origPath = path;\n  var pathSplitted = path.split('#');\n  path = pathSplitted[0];\n\n  var isQuery = pathSplitted.length > 1;\n  var queryParams = isQuery ? pathSplitted[1].split('&') : [];\n  var queryId = isQuery ? queryParams.map(function (param) {\n    var splittedParam = param.split('=');\n\n    if (splittedParam[0] === 'queryId') {\n      return splittedParam[1];\n    }\n  }).filter(function (q) {\n    return q;\n  }) : undefined;\n  return queryId && queryId.length > 0 ? event ? event + ':/' + queryId : queryId[0] : isQuery ? origPath : undefined;\n};\n\nvar setWatcher = exports.setWatcher = function setWatcher(firebase, dispatch, event, path, queryId) {\n  var id = queryId || getQueryIdFromPath(path, event) || getWatchPath(event, path);\n\n  if (firebase._.watchers[id]) {\n    firebase._.watchers[id]++;\n  } else {\n    firebase._.watchers[id] = 1;\n  }\n\n  dispatch({ type: _constants.actionTypes.SET_LISTENER, path: path, payload: { id: id } });\n\n  return firebase._.watchers[id];\n};\n\nvar getWatcherCount = exports.getWatcherCount = function getWatcherCount(firebase, event, path, queryId) {\n  var id = queryId || getQueryIdFromPath(path, event) || getWatchPath(event, path);\n  return firebase._.watchers[id];\n};\n\nvar unsetWatcher = exports.unsetWatcher = function unsetWatcher(firebase, dispatch, event, path, queryId) {\n  var id = queryId || getQueryIdFromPath(path, event) || getWatchPath(event, path);\n  path = path.split('#')[0];\n  var watchers = firebase._.watchers;\n\n  if (watchers[id] <= 1) {\n    delete watchers[id];\n    if (event !== 'first_child' && event !== 'once') {\n      firebase.database().ref().child(path).off(event);\n    }\n  } else if (watchers[id]) {\n    watchers[id]--;\n  }\n\n  dispatch({ type: _constants.actionTypes.UNSET_LISTENER, path: path, payload: { id: id } });\n};\n\nvar applyParamsToQuery = exports.applyParamsToQuery = function applyParamsToQuery(queryParams, query) {\n  var doNotParse = false;\n  if (queryParams) {\n    queryParams.forEach(function (param) {\n      param = param.split('=');\n      switch (param[0]) {\n        case 'orderByValue':\n          query = query.orderByValue();\n          doNotParse = true;\n          break;\n        case 'orderByPriority':\n          query = query.orderByPriority();\n          doNotParse = true;\n          break;\n        case 'orderByKey':\n          query = query.orderByKey();\n          doNotParse = true;\n          break;\n        case 'orderByChild':\n          query = query.orderByChild(param[1]);\n          break;\n        case 'limitToFirst':\n          query = query.limitToFirst(parseInt(param[1], 10));\n          break;\n        case 'limitToLast':\n          query = query.limitToLast(parseInt(param[1], 10));\n          break;\n        case 'notParsed':\n          doNotParse = true;\n          break;\n        case 'parsed':\n          doNotParse = false;\n          break;\n        case 'equalTo':\n          var equalToParam = !doNotParse ? tryParseToNumber(param[1]) : param[1];\n          equalToParam = equalToParam === 'null' ? null : equalToParam;\n          equalToParam = equalToParam === 'false' ? false : equalToParam;\n          equalToParam = equalToParam === 'true' ? true : equalToParam;\n          query = param.length === 3 ? query.equalTo(equalToParam, param[2]) : query.equalTo(equalToParam);\n          break;\n        case 'startAt':\n          var startAtParam = !doNotParse ? tryParseToNumber(param[1]) : param[1];\n          startAtParam = startAtParam === 'null' ? null : startAtParam;\n          query = param.length === 3 ? query.startAt(startAtParam, param[2]) : query.startAt(startAtParam);\n          break;\n        case 'endAt':\n          var endAtParam = !doNotParse ? tryParseToNumber(param[1]) : param[1];\n          endAtParam = endAtParam === 'null' ? null : endAtParam;\n          query = param.length === 3 ? query.endAt(endAtParam, param[2]) : query.endAt(endAtParam);\n          break;\n      }\n    });\n  }\n\n  return query;\n};\n\nvar orderedFromSnapshot = exports.orderedFromSnapshot = function orderedFromSnapshot(snap) {\n  if (snap.hasChildren && !snap.hasChildren()) {\n    return null;\n  }\n  var ordered = [];\n  if (snap.forEach) {\n    snap.forEach(function (child) {\n      ordered.push({ key: child.key, value: child.val() });\n    });\n  }\n  return (0, _size3.default)(ordered) ? ordered : null;\n};\n\nvar populateAndDispatch = exports.populateAndDispatch = function populateAndDispatch(firebase, dispatch, config) {\n  var data = config.data,\n      populates = config.populates,\n      snapshot = config.snapshot,\n      path = config.path,\n      storeAs = config.storeAs;\n\n  return (0, _populate.promisesForPopulate)(firebase, snapshot.key, data, populates).then(function (results) {\n    (0, _forEach3.default)(results, function (result, path) {\n      dispatch({\n        type: _constants.actionTypes.MERGE,\n        path: path,\n        data: result\n      });\n    });\n    dispatch({\n      type: _constants.actionTypes.SET,\n      path: storeAs || path,\n      data: data,\n      ordered: orderedFromSnapshot(snapshot)\n    });\n    return results;\n  }).catch(function (err) {\n    dispatch({\n      type: _constants.actionTypes.ERROR,\n      payload: err\n    });\n    return Promise.reject(err);\n  });\n};"]},"metadata":{},"sourceType":"script"}